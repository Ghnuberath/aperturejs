var aperture=function(a){a=function(a){return a.VERSION="${project.version}",a}(a||{});var b=/([$0-9a-z_\-]+)(\[\])*(\.|$)/gi,c=function(a,b){var d,e,f,g=a.shift();if((d=g.indexOf("[]"))>0){if(e=(g.length-d)/2,g=g.slice(0,d),f=this[g],null===f)return f;for(;e>0;)f=f[b.shift()],e-=1}else f=this[g];return a.length?c.call(f,a,b):f};return a.util=function(a){a.viewOf=function(a){function b(){}return b.prototype=a,new b};var b=Array.prototype,c=b.slice,d=b.forEach,e=b.map,f=b.filter,g=b.indexOf,h=Array.isArray,i=Function.prototype.bind,j=Object.prototype.hasOwnProperty,k=Object.prototype.toString,l=function(){};return a.forEach=function(a,b,c){if(null!==a)if(d&&a.forEach===d)a.forEach(b,c);else if(a.length===+a.length)for(var e=0,f=a.length;f>e;e++)e in a&&b.call(c,a[e],e,a);else for(var g in a)j.call(a,g)&&b.call(c,a[g],g,a)},a.forEachUntil=function(a,b,c,d){if(null!==a&&null!==b){2===arguments.length&&(c=!0);var e;if(a.length===+a.length){for(var f=0,g=a.length;g>f;f++)if(f in a&&(e=b.call(d,a[f],f,a))===c)return e}else for(var h in a)if(j.call(a,h)&&(e=b.call(d,a[h],h,a))===c)return e;return e}},a.filter=function(b,c,d){var e=[];return null===b?e:f&&b.filter===f?b.filter(c,d):(a.forEach(b,function(a,f){c.call(d,a,f,b)&&(e[e.length]=a)}),e)},a.map=function(b,c,d){var f=[];if(null!==b){if(e&&b.map===e)return b.map(c,d);a.forEach(b,function(a,e){f[f.length]=c.call(d,a,e,b)})}return f},a.find=function(b,c,d){var e;return null!==b&&a.forEachUntil(b,function(a,f){return c.call(d,a,f,b)?(e=a,!0):void 0},!0),e},a.has=function(b,c){return b?!!a.forEachUntil(b,function(a){return a===c},!0):!1},a.hasAny=function(b,c){return b&&c?!!a.forEachUntil(b,function(b){return-1!==a.indexOf(c,b)},!0):!1},a.hasAll=function(b,c){return b&&c?!!a.forEachUntil(c,function(b){return-1!==a.indexOf(c,b)},!1):!1},a.indexOf=function(a,b){if(null!==a){if(g&&a.indexOf===g)return a.indexOf(b);for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c}return-1},a.without=function(b){var d=c.call(arguments,1);return a.filter(b,function(b){return!a.has(d,b)})},a.extend=function(b){return a.forEach(c.call(arguments,1),function(a){for(var c in a)void 0!==a[c]&&(b[c]=a[c])}),b},a.bind=function(b,d){if(i&&b.bind===i)return i.apply(b,c.call(arguments,1));if(!a.isFunction(b))throw new TypeError;var e,f=c.call(arguments,2);return e=function(){if(!(this instanceof e))return b.apply(d,f.concat(c.call(arguments)));l.prototype=b.prototype;var a=new l,g=b.apply(a,f.concat(c.call(arguments)));return Object(g)===g?g:a}},a.isNumber=function(a){return!!(0===a||a&&a.toExponential&&a.toFixed)},a.isString=function(a){return!!(""===a||a&&a.charCodeAt&&a.substr)},a.isArray=h||function(a){return"[object Array]"===k.call(a)},a.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},a.isObject=function(a){return a===Object(a)},a}(a.util||{}),a=function(b){var c,d=!1,e=Object.prototype.toString,f=function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&(c[c.length]=b);return a.toString!==e&&(c[c.length]="toString"),c},g=function(a,b,d){return function(e){return e?e===a||e===b||e.test&&e.test(a)?!0:(d||c)(e):a}};c=g("aperture.Class",b.Class,function(){return!1}),b.Class=function(){};var h=function(b,c){var d,e=this.prototype.typeOf()+".prototype."+b;return this.prototype[b]=d=function(){var b=function(){};b.prototype=this;var h=new b;return h._base=this,a.util.forEach(f(c),function(a){"init"!==a&&(h[a]=c[a])}),h.typeOf=g(e,d,this.typeOf),c.init&&c.init.apply(h,arguments),h},this};return b.Class.extend=function(c,e){function i(){!d&&this.init&&this.init.apply(this,arguments)}e||(e=c,c=null);var j=this.prototype;d=!0;var k=new this;return d=!1,a.util.forEach(f(e),function(a){k[a]=e[a]}),k.typeOf=g(c,i,j.typeOf),i.prototype=k,i.constructor=i,i.extend=b.Class.extend,i.addView=h,i},b}(a||{}),a.config=function(){var a={},b={};return{register:function(c,d){var e=a[c];e||(e=[],a[c]=e),e.push({callback:d}),b&&b[c]&&d(b)},provide:function(c){b=c;var d,e;for(d in b)if(b.hasOwnProperty(d)){var f=a[d];if(f)for(e=0;e<f.length;e++)f[e].callback(b)}},get:function(){return b}}}(),a.log=function(){function b(a,b,d){return n.error(a+" "+b+":"+d),c&&c.apply(this,arguments),i}var c,d={ERROR:"error",WARN:"warn",INFO:"info",DEBUG:"debug",LOG:"log",NONE:"none"},e={error:5,warn:4,info:3,debug:2,log:1,none:0},f=[],g=d.INFO,h=!1,i=!1,j="",k="        ",l=function(a){var b=Array.prototype.slice.call(arguments,1);return j+a.replace(/\{(\d+)\}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:"{"+c+"}"})},m=a.Class.extend("aperture.log.Appender",{init:function(a){this.level=a||d.WARN},level:function(a){return void 0!==a&&(this.level=a),this.level},log:function(b,c){if(e[b]>=e[this.level]){var d=Array.prototype.slice.call(arguments,1);if(a.util.isString(c))this.logString(b,l.apply(null,d));else if(this.logObjects)this.logObjects(b,d);else{var f=window.JSON?JSON.stringify(d):"No window.JSON interface exists to stringify logged object. A polyfill like json2.js is required.";this.logString(b,f)}}},logString:function(){}}),n={appenders:function(){return f},addAppender:function(a){return f.push(a),a},removeAppender:function(b){return f=a.util.without(f,b),b},logAtLevel:function(b){if(e[b]>=e[g]){var c=arguments;a.util.forEach(f,function(a){a.log.apply(a,c)})}},level:function(a){var b=g;return void 0!==a&&(g=a),b},isLogging:function(a){return e[a]>=e[g]},indent:function(a){if(0!==arguments.length)if(a)if(0>a)j=a<j.length?j.substring(0,j.length-a):"";else for(;a>0;)j+=k.substr(0,Math.min(a,8)),a-=8;else j="";return j},logWindowErrors:function(a,d){return null==a?h:(a=!!a,void(h!==a&&(h=a,i=!!d,h?(c=window.onerror,window.onerror=b):(window.onerror=c,c=void 0))))}};return a.util.forEach(d,function(b){n[b]=a.util.bind(n.logAtLevel,n,b)}),n.Appender=m,n.LEVEL=d,a.config.register("aperture.log",function(b){var c=b["aperture.log"];c.level&&n.level(c.level);var d=c.logWindowErrors;d&&n.logWindowErrors(!!d.log,d.preventDefault),a.util.forEach(c.appenders,function(b,c){c&&(c="add"+c.charAt(0).toUpperCase()+c.substr(1),a.util.isFunction(a.log[c])&&a.log[c](b))})}),n}(),a.canvas=function(b){var c={};return b.handle=function(a,b){c[a]=b},b.type=function(a){return c[a]},b.DIV_CANVAS="DIV_CANVAS",b.VECTOR_CANVAS="VECTOR_CANVAS",b.Canvas=a.Class.extend("aperture.canvas.Canvas",{init:function(a){this.root_=a,this.canvases_=[]},remove:function(){return this},canvas:function(b){if(!b||!(b=c[b])||this.typeOf(b))return this;var d=a.util.find(this.canvases_,function(a){return a.typeOf(b)});return d||(d=new b(this.root()),this.canvases_.push(d)),d},root:function(){return this.root_},graphics:function(){return b.NO_GRAPHICS},flush:function(){var a,b=0;for(a=this.canvases_.length;a>b;b++)this.canvases_[b].flush()}}),b.handle(b.DIV_CANVAS,b.Canvas.extend("aperture.canvas.DivCanvas",{})),b.Graphics=a.Class.extend("aperture.canvas.Graphics",{init:function(a){this.canvas=a},display:function(){return!0},toFront:function(){return this},toBack:function(){return this},remove:function(){return this},on:function(){return this},off:function(){return this},data:function(){return this}}),b.NO_GRAPHICS=new b.Graphics,b.VectorCanvas=b.Canvas.extend("aperture.canvas.VectorCanvas",{graphics:function(){}}),b.VectorGraphics=b.Graphics.extend("aperture.canvas.VectorGraphics",{}),b}(a.canvas||{}),a=function(b){return b.Transition=a.Class.extend("aperture.Transition",{init:function(a,b,c){this.time=a||300,this.fn=b||"ease",this.end=c},milliseconds:function(){return this.time},easing:function(){return this.fn},callback:function(){return this.end}}),b}(a||{}),a=function(b){function c(a,b,c,f){var g=n.viewOf(b),h=b.kids,i=a.uid;return(h[i]||(h[i]=[])).push(g),g.uid=(l++).toString(),g.parent=b,g.next=null,g.prev=null,g.layer=a,g.kids={},g.userData={},g.graphics=m,f&&(g.data=f,g.idFn=a.idFunction),d(g),e(g,c),g}function d(a){var b=a.layer;if(b){var c=b.valueFor("visible",a.data,!0);if(a.appearing=!1,c)if(a.graphics===m&&a.parent.graphics){var d=a.graphics=b.canvas_.graphics(a.parent.graphics).data(a);o(b.handlers_,function(a,b){d.on(b,this)},b),a.appearing=!0}else a.appearing=a.graphics.display(!0);else a.graphics&&a.graphics.display(!1);return c}}function e(a,b){null==b?(a.next=a.layer.nodes_,a.layer.nodes_=a,a.prev=null):(a.next=b.next,b.next=a,a.prev=b),a.next&&(a.next.prev=a)}function f(a){a.prev?a.prev.next=a.next:a.layer.nodes_=a.next,a.next&&(a.next.prev=a.prev)}function g(a){var b=a.parent.kids[a.layer.uid],c=p(b,a);-1!==c&&b.splice(c,1),a.graphics.remove(),a.graphics=null,a.layer=null}function h(a){var b,f=a.changed;if(this.dataChangeHints){var g,h,j,k=this.parentLayer_&&this.parentLayer_.nodes_||this.rootNode_,l=a.added,m=a.removed,n=this.uid,p=this.idFunction;for(this.nodes_=null,h=k;null!=h;h=h.next){var q=i(h.kids[n]),r=h.kids[n]=[];for(o(this.dataItems(h.data),function(a){b=null;var i=p?p.call(a):a;for(j=q.next;null!=j;j=j.next){if(b=j.node,(b.idFn?b.idFn.call(b.data):b.data)===i){j.prev.next=j.next,j.next&&(j.next.prev=j.prev);break}b=null}b?(r.push(b),e(b,g),b.data=a,b.idFn=p,d(b)&&this.dataChangeHints.changed&&f.push(b)):l.push(b=c(this,h,g,a)),g=b},this),j=q.next;null!=j;j=j.next)m.push(j.node)}}else{if(!a.updateAll)return!1;for(b=this.nodes_;null!=b;b=b.next)d(b)&&f.push(b)}return a.updateAll=!1,!0}function i(a){var b={};if(a){var c,d=a.length,e=b;for(c=0;d>c;++c)e=e.next={prev:e,node:a[c]}}return b}function j(){return this.id}var k=a.log,l=1,m=a.canvas.NO_GRAPHICS,n=a.util,o=n.forEach,p=n.indexOf,q=function(){var a=[null],b=[];return function(c){return c?a:b}}(),r=a.Class.extend("aperture.Layer",{init:function(a,b){a=a||{},this.uid=(l++).toString(),this.parentLayer_=a.parent,this.rootNode_=a.rootNode,this.vizlet_=a.vizlet||this,this.canvas_=a.parentCanvas&&a.parentCanvas.canvas(this.canvasType),this.handlers_={},this.renderedLocalData_=!1,this.nodes_=void 0,this.dataItems=q,this.hasLocalData=!1,this.maps_=this.parentLayer_&&this.parentLayer_.mappings?n.viewOf(this.parentLayer_.mappings()):{},this.mapAll(a.mappings),this.mapAll(b)},remove:function(){if(this.parentLayer_){this.parentLayer_.layers_=n.without(this.parentLayer_.layers_,this),this.parentLayer_=null;var a;for(a=this.nodes_;null!=a;a=a.next)g(a);this.nodes_=null}return this},map:function(a){var c=this.maps_;if(c.hasOwnProperty(a))return c[a];var d=this.parentLayer_?n.viewOf(this.parentLayer_.map(a)):new b.Mapping(a);return c[a]=d},mapAll:function(a){o(a,function(a,b){this.map(b).asValue(a)},this)},mappings:function(){return this.maps_},valueFor:function(a,b,c){var d=this.maps_[a];if(d){var e=Array.prototype.slice.call(arguments,3),f=d.valueFor(b,e);if(null!=f)return f}return c},transform:function(a,b,c,d){var e;if(a){if(!(arguments.length>1)){var f={},g=this.maps_;return o(a,function(a){e===g[a]&&(f[a]=e.value(a,c,d))}),f}if(e===this.maps_[a])return e.value(b,c,d)}},valuesFor:function(a,b,c){var d,e,f,g={};for(d in a)a.hasOwnProperty(d)&&(g[d]=(e=this.maps_[d])&&null!=(f=e.valueFor(b,c||[]))?f:a[d]);return g},canvasType:a.canvas.DIV_CANVAS,all:function(){return this.join.apply(this,arguments)},join:function(b,c){return 0!==arguments.length&&(this.dataItems=q,this.hasLocalData=!1,b&&(this.hasLocalData=!0,n.isFunction(b)?(this.dataItems=b,b=null):(n.isArray(b)||(b=[b]),this.dataItems=function(){return b},this.dataItems.values=b)),void 0!==c?this.idFunction=n.isString(c)?"id"===c?j:function(){return this[c]}:c:this.idFunction||(this.idFunction=b&&b.length&&b[0].id?j:null),this.dataChangeHints={delta:!0,changed:!0}),new a.Layer.LogicalNodeSet(this)},add:function(b){if(this.hasLocalData&&this.dataItems.values){var c=this.dataItems.values.concat(b);return this.dataItems=function(){return c},this.dataItems.values=c,this.dataChangeHints=this.dataChangeHints||{},this.dataChangeHints.delta=!0,new a.Layer.LogicalNodeSet(this).where(b)}if(this.hasLocalData)throw new Error("Can only add data to a layer with a dataset already specified");return this.all(b)},removeNodeSet:function(a){if(this.hasLocalData&&this.dataItems.values){for(var b,c=a.data(),d=[];b=c.next();)d.push(b);var e=n.filter(this.dataItems.values,function(a){return!n.has(d,a)});return this.dataItems=function(){return e},this.dataItems.values=e,this.dataChangeHints=this.dataChangeHints||{},this.dataChangeHints.delta=!0,a}throw new Error("Can only remove data from a layer with a dataset already specified")},processChangeSet:function(a){var b,e,i,j=n.viewOf(a),l=this.uid,q=this.hasLocalData,r=j.changed=[],s=j.added=[],t=j.removed=[];if(a.dataChanged&&q&&!this.dataItems.values&&(this.dataChangeHints=this.dataChangeHints||{},this.dataChangeHints.changed=!0),j.dataChanged=this.dataChangeHints&&this.dataChangeHints.changed,this.renderedLocalData_!==q){for(this.renderedLocalData_=q,b=this.nodes_;null!=b;b=b.next)t.push(b);this.nodes_=null}var u,v;if(this.nodes_)q&&h.call(this,j,a)||(o(a.removed,function(a){var c=a.kids[l];if(i=c&&c.length)for(e=0;i>e;++e)t.push(b=c[e]),f(b)},this),o(a.changed,function(a){var c=a.kids[l];if(i=c&&c.length)for(e=0;i>e;++e)d(b=c[e])&&r.push(b)},this),o(a.added,function(a){var b=a.prev&&a.prev.kids[l];u=b&&b.length&&b[b.length-1],o(this.dataItems(a.data),function(b){s.push(u=c(this,a,u,b))},this)},this));else{for(v=this.parentLayer_&&this.parentLayer_.nodes_||this.rootNode_;null!=v;v=v.next){var w=function(a){s.push(u=c(this,v,u,a))};o(this.dataItems(v.data),w,this)}!this.nodes_&&j.rootSet.hasLayer(this)&&(j.updateAll=!0)}if(o(t,function(a){g(a)},this),j.rootSet.hasLayer(this))for(e=j.rootSet.nodes(this);null!=(b=e.next());)-1===p(r,b)&&-1===p(s,b)&&d(b)&&r.push(b);if(0!==s.length){var x=j.updates=j.changed.slice();o(s,function(a){a.graphics!==m&&x.push(a)},this)}else j.updates=j.changed;if(k.isLogging(k.LEVEL.DEBUG)){var y=" + ",z=" * ",A=" - ";o(j.added,function(a){y+=a.uid+", "}),o(j.changed,function(a){z+=a.uid+", "}),o(j.removed,function(a){A+=a.uid+", "}),k.debug(">> "+this.typeOf()),k.debug(y),k.debug(z),k.debug(A)}return this.dataChangeHints=null,j},toFront:function(){if(this.parentLayer_){var a,b=this.parentLayer_.layers_,c=p(b,this);if(c!==b.length-1)for(b.push(b.splice(c,1)[0]),a=this.nodes_;null!=a;a=a.next)a.graphics.toFront()}return this},toBack:function(){if(this.parentLayer_){var a,b=this.parentLayer_.layers_,c=p(b,this);if(0!==c)for(b.splice(0,0,b.splice(c,1)[0]),a=this.nodes_;null!=a;a=a.next)a.graphics.toBack()}return this},render:function(){},on:function(a,b){var c,d=this.handlers_;if(d[a])d[a].push(b);else for(d[a]=[b],c=this.nodes_;null!=c;c=c.next)c.graphics.on(a,this)},off:function(a,b){var c,d=this.handlers_;if(d[a]=b?n.without(d[a],b):[],0===d[a].length){for(c=this.nodes_;null!=c;c=c.next)c.graphics.off(a,this);d[a]=null}},trigger:function(a,b){var c=n.forEachUntil(this.handlers_[a],function(a){return a.call(this,b)},!0,this);return c&&b&&b.source&&(b=b.source,b.stopPropagation?b.stopPropagation():b.cancelBubble=!0),c},parent:function(){return this.parentLayer_},vizlet:function(){return this.vizlet_}});b.Layer=r;var s=r.extend("aperture.PlotLayer",{init:function(b,c){a.Layer.prototype.init.call(this,b,c),this.layers_=[]},addLayer:function(a,b,c){c=c||{},n.extend(c,{parent:this,vizlet:this.vizlet_,rootNode:this.rootNode_,parentCanvas:this.canvas_},this.layerSpec_);var d=new a(c,b);return this.layers_.push(d),d},render:function(a){k.isLogging(k.LEVEL.DEBUG)&&k.indent(4),o(this.layers_,function(b){this.renderChild(b,b.processChangeSet(a))},this),k.isLogging(k.LEVEL.DEBUG)&&k.indent(-4)},remove:function(){return this.parentLayer_&&(a.Layer.prototype.remove.call(this),o(this.layers_,function(a){a.remove()}),this.layers_=[]),this},renderChild:function(a,b){a.render(b)}});return b.PlotLayer=s,b}(a||{}),a.vizlet=function(b){var c=a.log,d=function(b,d){return function(e,f){var g,h,i={uid:0,width:0,height:0,position:[0,0],anchorPoint:[0,0],userData:{},graphics:a.canvas.NO_GRAPHICS,kids:{}};if(e&&1===e.nodeType)g=e,e={};else{if(a.util.isString(e))h=e,e={};else{if(!e||!e.id)return c.error("Cannot make a vizlet from object without an id.");h=e.id}"body"===h?g=document.body:("#"===h.charAt(0)&&(h=h.substr(1)),g=document.getElementById(h))}var j=a.canvas.type(a.canvas.DIV_CANVAS);a.util.extend(e,{parent:null,rootNode:i,parentCanvas:new j(g)});{var k=new b(e,f);k.update}return k.redraw=function(a,b){c.isLogging(c.LEVEL.DEBUG)&&(c.indent(0),c.debug("------------------------------"),c.debug(" UPDATE"),c.debug("------------------------------")),i.width=g.offsetWidth,i.height=g.offsetHeight;var d={updates:[],changed:[],removed:[],properties:null,rootSet:a,transition:b};return this.render(this.processChangeSet(d)),e.parentCanvas.flush(),this},d&&d.apply(k,arguments),k}};return b.make=d,a.Plot=d(a.PlotLayer),b}(a.vizlet||{}),a=function(b){var c=b.util;b.Format=b.Class.extend("aperture.Format",{format:function(a){return String(a)},nextOrder:function(){}}),b.NumberFormat=b.Format.extend("aperture.NumberFormat",{decimals:0,init:function(b){if(b)if(isNaN(b))a.log.warn('Invalid precision "'+b+'" in NumberFormat');else{var c=this.precision=Number(b);if(1>c){var d=c.toString(),e=d.indexOf(".");-1!==e&&(this.decimals=d.length-1-e)}}},format:function(a){a=null!=a&&this.precision?Math.round(a/this.precision)*this.precision:Number(a);var b=a.toFixed(this.decimals),c=b.indexOf(".");for(c=(-1!==c?c:b.length)-3;c>0;c-=3)b=b.substring(0,c).concat(",").concat(b.substring(c));return b}}),b.Format.getNumberFormat=function(a){return new b.NumberFormat(a)},b.CurrencyFormat=b.NumberFormat.extend("aperture.CurrencyFormat",{init:function(b,c,d){if(b)if(isNaN(b))a.log.warn('Invalid precision "'+b+'" in CurrencyFormat');else{var e=this.precision=Number(b);if(1>e){var f=e.toString(),g=f.indexOf(".");-1!==g&&(this.decimals=f.length-1-g)}}this.prefix=c||"",this.suffix=d||""},format:function(a){a=Number(a);var b="",c=Math.abs(a);c>=1e12?(b="T",c*=1e-12):c>=1e9?(b="B",c*=1e-9):c>=1e6?(b="M",c*=1e-6):c>=1e3&&(b="K",c*=.001),this.precision&&(c=Math.round(c/this.precision)*this.precision);var d=0>a?"-":"",e=c.toFixed(this.decimals),f=e.indexOf(".");for(f=(-1!==f?f:e.length)-3;f>0;f-=3)e=e.substring(0,f).concat(",").concat(e.substring(f));return d+this.prefix+e+b+this.suffix}}),b.Format.getCurrencyFormat=function(a,c,d){return new b.CurrencyFormat(a,c,d)};var d=function(){function a(a){return 10>a?"0"+a:String(a)}function b(a){var b=a.get("Hours");return b?String(13>b?b:b-12):"12"}function c(a){return a.get("Hours")<12?"am":"pm"}function d(a){return":"+(1e3*a.get("Seconds")+a.get("Milliseconds"))/1e3+"s"}function e(b){return":"+a(b.get("Seconds"))+"s"}function f(d){return b(d)+":"+a(d.get("Minutes"))+c(d)}function g(a){return b(a)+c(a)}function h(a){return l[a.get("Month")]+" "+a.get("Date")}function i(a){return l[a.get("Month")]}function j(a){return String(a.get("FullYear"))}function k(a){return"'"+String(a.get("FullYear")).substring(2,4)}var l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],m="FullYear",n="Date",o="Minutes";return{FullYear:{format:j},Year:{format:k},Month:{format:i,next:m},Date:{format:h,next:m},Day:{format:h,next:m},Hours:{format:g,next:n},Minutes:{format:f,next:n},Seconds:{format:e,next:o},Milliseconds:{format:d,next:o}}}();return b.TimeFormat=b.Format.extend("aperture.TimeFormat",{_utc:!0,init:function(b){c.isString(b)&&(b={precision:b}),b&&b.precision&&(this.order=d[b.precision],this.order||a.log.warn('Invalid precision "'+b.precision+'" in TimeFormat')),this._utc=!(b&&b.local)},format:function(b){return null!=b&&(b.typeOf&&b.typeOf(a.Date)||(b=new a.Date(b,{local:!this._utc})),this.order)?this.order.format(b):String(b)},nextOrder:function(){return this.order?this.order.next:void 0}}),b.Format.getTimeFormat=function(a){return new b.TimeFormat(a)},b}(a||{}),a=function(b){var c,d,e=Math.round,f=function(a,b){var c=a.match(/([0-9\.]+)(%*)/),d=parseFloat(c[1]);return c[2]?d*b:d},g=function(a){return e(f(a,2.55))},h=function(a,b,c,d){function f(a){return a-=360*Math.floor(a/360),60>a?i+(h-i)*a/60:180>a?h:240>a?i+(h-i)*(240-a)/60:i}function g(a){return e(255*f(a))}if(b=Math.min(1,Math.max(0,b)),c=Math.min(1,Math.max(0,c)),0===b)return void(d.r=d.g=d.b=e(255*c));var h=.5>=c?c*(1+b):c+b-c*b,i=2*c-h;d.r=g(a+120),d.g=g(a),d.b=g(a-120),d.h=a,d.s=b,d.l=c,d.v=Math.max(d.r,d.g,d.b)/255},i=function(a,b,c,d){d.h=a,d.s=b,d.v=c,a/=60;var e=Math.floor(a),f=a-e,g=c*(1-b),h=c*(1-f*b),i=c*(1-(1-f)*b);switch(e%6){case 0:d.r=c,d.g=i,d.b=g;break;case 1:d.r=h,d.g=c,d.b=g;break;case 2:d.r=g,d.g=c,d.b=i;break;case 3:d.r=g,d.g=h,d.b=c;break;case 4:d.r=i,d.g=g,d.b=c;break;case 5:d.r=c,d.g=g,d.b=h}d.l=(Math.max(d.r,d.g,d.b)+Math.min(d.r,d.g,d.b))/2,d.r=Math.round(255*d.r),d.g=Math.round(255*d.g),d.b=Math.round(255*d.b)},j=function(a){if(null==a.h){var b,c,d=a.r/255,e=a.g/255,f=a.b/255,g=Math.max(d,e,f),h=Math.min(d,e,f),i=(g+h)/2;if(g===h)b=c=0;else{var j=g-h;switch(c=i>.5?j/(2-g-h):j/(g+h),g){case d:b=(e-f)/j;break;case e:b=(f-d)/j+2;break;case f:b=(d-e)/j+4}b=(b+360)%6*60}a.h=b,a.s=c,a.l=i,a.v=g}},k=function(a){return a=a.toString(16),a.length<2?"0"+a:a},l=function(a,b,c,d){return d>.9999?"#"+k(a)+k(b)+k(c):"rgba("+a.toString()+","+b.toString()+","+c.toString()+","+d.toString()+")"},m=function(a){a.color=l(a.r,a.g,a.b,a.a)};return b.Color=a.Class.extend("aperture.Color",{init:function(b){if(!b)return this.r=this.g=this.b=this.a=0,void(this.color="#000000");if(this.color=b=b.toLowerCase(),"#"===b.charAt(0)){var c=7===b.length?1:0,d=0;return this.r=parseInt(b.charAt(++d)+b.charAt(d+=c),16),this.g=parseInt(b.charAt(++d)+b.charAt(d+=c),16),this.b=parseInt(b.charAt(++d)+b.charAt(d+=c),16),void(this.a=1)}var e=b.match(/([a-z]+)\((.*)\)/i);if(e){var i,j,k,l=e[1].substring(0,3),m=e[2].split(",");switch(this.a=m.length>3?f(m[3],.01):1,l){case"rgb":return this.r=g(m[0]),this.g=g(m[1]),void(this.b=g(m[2]));case"hsl":return i=f(m[0],3.6),j=f(m[1],.01),k=f(m[2],.01),void h(i,j,k,this)}}b=a.palette.color(b),b||a.log.warn("unrecognized color "+b),this.init(b)},blend:function(a,c){"string"==typeof a&&(a=new b.Color(a));var d=1-c,f=new b.Color;return f.r=e(d*this.r+c*a.r),f.g=e(d*this.g+c*a.g),f.b=e(d*this.b+c*a.b),f.a=.001*e(1e3*(d*this.a+c*a.a)),m(f),f},band:function(a,b){var c=[this];if(b>1){c.length=b;var d,e=b-1;for(d=1;b>d;d++)c[d]=this.blend(a,d/e)}return c},hue:function(a){return j(this),null!=a?c(a,this.s,this.l,this.a):this.h},saturation:function(a){return j(this),null!=a?c(this.h,a,this.l,this.a):this.s},lightness:function(a){return j(this),null!=a?c(this.h,this.s,a,this.a):this.l},brightness:function(a){return j(this),null!=a?d(this.h,this.s,a,this.a):this.v},css:function(){return this.color},toString:function(){return this.color}}),b.Color.fromHSL=c=function(a,c,d,e){var f=new b.Color;if("number"!=typeof a){if(null==a.h)return f;c=a.s,d=a.l,e=a.a,a=a.h}return f.a=null!=e?e:1,h(a,c,d,f),m(f),f},b.Color.fromHSB=d=function(a,c,d,e){var f=new b.Color;if("number"!=typeof a){if(null==a.h)return f;c=a.s,d=a.b,e=a.a,a=a.h}return f.a=null!=e?e:1,i(a,c,d,f),m(f),f},b.Color.fromRGB=function(a,c,d,e){var f=new b.Color;if("number"!=typeof a){if(null==a.r)return f;c=a.g,d=a.b,e=a.a,a=a.r}return f.r=a,f.g=c,f.b=d,f.a=null!=e?e:1,m(f),f},b.Color.band=function(a,b){return a&&a.length?a[0].band(a[a.length-1],b):void 0},b}(a||{}),a=function(b){var c=a.util,d=["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"];return b.Date=a.Class.extend("aperture.Date",{_utc:!0,_date:null,init:function(a,b){this._date="[object Date]"===Object.prototype.toString.call(a)?a:new Date(a.valueOf()),this._utc=!(b&&b.local)},get:function(a){if(a){var b="get"+(this._utc?"UTC":"")+a;if(!this._date[b])throw new Error("Unrecognized date unit: "+a);return this._date[b]()}var e=this,f={};return c.forEach(d,function(a){f[a]=e.get(a)}),f},set:function(a,b){var d=this._utc?"setUTC":"set";if(c.isObject(a)){var e=c.extend(this.get(),a);this._date[d+"FullYear"](e.FullYear,e.Month,e.Date),this._date[d+"Hours"](e.Hours,e.Minutes,e.Seconds,e.Milliseconds)}else{if(!this._date[d+b])throw new Error("Unrecognized date unit: "+b);this._date[d+b](a)}return this},utc:function(){return this._utc=!0,this},local:function(){return this._utc=!1,this},valueOf:function(){return this._date.valueOf()},add:function(a,b){var c=(this._utc?"UTC":"")+b;return this._date["set"+c](this._date["get"+c]()+a),this},toString:function(){return this._utc?this._date.toUTCString():this._date.toString()}}),b}(a||{}),a=function(b){var c={x:0,y:0,width:24,height:24,opacity:""},d={ontology:"aperture-hscb",type:"undefined",attributes:{},format:void 0};return b.IconLayer=a.Layer.extend("aperture.IconLayer",{init:function(b,c){a.Layer.prototype.init.call(this,b,c)},canvasType:a.canvas.VECTOR_CANVAS,render:function(b){var e,f=b.updates,g=f.length;for(e=g-1;e>=0;e--){var h,i,j=f[e],k=j.data,l=j.graphics,m=j.width,n=j.height,o=j.userData.icons||(j.userData.icons=[]),p=this.valueFor("icon-count",k,1),q=0;for(h=0;p>h;h++){if(i=this.valuesFor(c,k,[h]),i.x=i.x*m+j.position[0]-this.valueFor("anchor-x",k,.5,h)*i.width,i.y=i.y*n+j.position[1]-this.valueFor("anchor-y",k,.5,h)*i.height,i.src=this.valueFor("url",k,"",h),!i.src){var r=this.valuesFor(d,k);"svg"!==r.format&&(r.width=i.width,r.height=i.height),i.src=a.palette.icon(r)}var s=o[q];s?l.attr(s,i,b.transition):(s=l.image(i.src,i.x,i.y,i.width,i.height),l.attr(s,i),l.apparate(s,b.transition),o.push(s)),l.data(s,k),q++}o.length>q&&l.removeAll(o.splice(q))}}}),b}(a||{}),a=function(b){var c={horizontal:0,vertical:-90},d=a.util.isString;return b.LabelLayer=b.Layer.extend("aperture.LabelLayer",{init:function(b,c){a.Layer.prototype.init.call(this,b,c)},canvasType:a.canvas.VECTOR_CANVAS,render:function(b){var e,f,g,h,i=b.updates;for(f=0;f<i.length;f++){e=i[f],h=e.userData.labels=e.userData.labels||[];var j,k=this.valueFor("label-count",e.data,1);for(g=e.graphics,j=k;j<h.count;j++)g.remove(h[j].back),g.remove(h[j].front);for(h.length=k,j=0;k>j;j++){var l=!!this.valueFor("label-visible",e.data,!0,j),m=h[j];if(l){var n=this.valueFor("fill",e.data,"#000000",j),o=this.valueFor("opacity",e.data,"",j),p=this.valueFor("font-outline",e.data,"none",j),q=this.valueFor("x",e.data,0,j)*e.width+(e.position[0]||0),r=this.valueFor("y",e.data,0,j)*e.height+(e.position[1]||0),s="none"!==p&&this.valueFor("font-outline-width",e.data,3,j),t=this.valueFor("connect",e.data,!1,j),u=this.valueFor("text",e.data,"",j),v=this.valueFor("font-family",e.data,"Arial",j),w=this.valueFor("font-size",e.data,10,j),x=this.valueFor("font-weight",e.data,"normal",j),y=u.match(/\n/g),z=1.4*w+w*(y?y.length:0),A="",B=this.valueFor("orientation",e.data,null,j);d(B)&&(B=c[B]||B),B&&(A+="r"+B);var C=this.valueFor("offset-x",e.data,0,j),D=this.valueFor("offset-y",e.data,0,j),E=this.valueFor("text-anchor",e.data,"middle",j),F=this.valueFor("text-anchor-y",e.data,"middle",j);F="middle"!==F?.5*z*("top"===F?1:-1):0,A?A+=",t0,"+F:D+=F,q+=C,r+=D;var G,H={x:q,y:r,text:u,stroke:"none","font-family":v,"font-size":w,"font-weight":x,"text-anchor":E,transform:A,opacity:o};if(m||(m=h[j]={}),s){G=a.util.extend({fill:n},H);var I=this.valueFor("font-outline-opacity",e.data,1,j);""!==I&&null!=I&&1!==I?""!==o&&null!=o&&(I=Math.min(1,o*I)):I=o,H.opacity=1!==I?I:"",H["stroke-width"]=s,H.stroke=p,H["stroke-linecap"]="round",H["stroke-linejoin"]="round"}else m.front&&(g.remove(m.front),m.front=null),H.stroke="none",H.fill=n;if(j=[j],m.back?g.attr(m.back,H,b.transition):(m.back=g.text(q,r,u),g.data(m.back,e.data,j),g.attr(m.back,H),g.apparate(m.back,b.transition)),t){var J=this.valueFor("connect-x",e.data,0,j),K=this.valueFor("connect-y",e.data,0,j),L="M"+(q-C+J)+" "+(r-D+K)+"L"+q+" "+r;if(m.path){var M={path:L};g.attr(m.path,M,b.transition)}else m.path=g.path(L)}else m.path&&g.remove(m.path);s&&(m.front?g.attr(m.front,G,b.transition):(m.front=g.text(q,r,u),g.data(m.front,e.data,j),g.attr(m.front,G),g.apparate(m.front,b.transition)))}else m&&(g.remove(m.back),g.remove(m.front),h[j]=null)}}}}),b}(a||{}),a=function(b){function c(){return this.id}function d(a,b,c){var d=this._layer;if(d.hasLocalData){var e,g,h,i,k=b||"plane";if(f.isFunction(a)){var l=[];for(g=this.nodes();null!=(e=g.next());)l.push({key:d.valueFor(k,e.data,null),gfx:e.graphics});for(l.sort(function(b,c){return a(b.key,c.key)}),i=l.length,h=0;i>h;++h)l[h].gfx[c]()}else if(a)for(f.isArray(a)||(a=[a]),i=a.length,h=0;i>h;++h)for(g=this.nodes();null!=(e=g.next());)e.graphics!==j&&a[h]===d.valueFor(k,e.data,null)&&e.graphics[c]();else for(g=this.nodes();null!=(e=g.next());)e.graphics[c]();return this}}var e,f=a.util,g=f.isArray,h=f.isString,i=f.isFunction,j=(f.forEach,a.canvas.NO_GRAPHICS),k=function(){return!1},l={next:function(){}},m=a.Class.extend("[private].LogicalAllIter",{init:function(a){this._cur={next:a}},next:function(){var a=this._cur;return a&&(this._cur=a.next)}}),n=a.Class.extend("[private].LogicalMatchIter",{init:function(a,b){this._nodeSet=a,this._where=a._where,this._cur={next:a._layer.nodes_},this._cache=b?[]:null},next:function(){var a=this._cur;if(a){for(var b=this._where,c=this._cache;(a=a.next)&&!b.call(a.data););return c&&(a&&c.push(a),a&&a.next||(this._nodeSet._cache=this._nodeSet._cache||c,c=null)),this._cur=a}}}),o=a.Class.extend("[private].ArrayIter",{init:function(a){this._array=a,this._ix=0},next:function(){var a=this._array;if(a){var b=this._ix,c=a[b++];return(this._ix=b)===a.length&&(this._array=null),c}}}),p=a.Class.extend("[private].SingleIter",{init:function(a){this._cur=a},next:function(){var a=this._cur;return a?(this._cur=null,a):void 0}}),q=a.Class.extend("[private].MultiSetIter",{init:function(a,b){this._sets=a,this._ix=0,this._layer=b,this._cur=a[0].nodes(b)},next:function(){var a=this._cur;if(a){for(var b,c=a.next();!c&&null!=(b=this._sets[this._ix+=1]);)this._cur=a=b.nodes(this._layer),c=a.next();return c}}}),r=a.Class.extend("[private].DataIter",{init:function(a){this._nodes=a,this._cur=a.next()},next:function(){var a=this._cur;return a?(this._cur=this._nodes.next(),a.data):void 0}});a.Layer.NodeSet=a.Class.extend("aperture.Layer.NodeSet",{init:function(a){this._layer=a,this._vizlets=[a.vizlet()]},where:function(a,b){if(this.revalidate(),h(a)){var d=a;a="id"===d?c:function(){return this[d]}}else if(!i(a)){if(!a)return this._where=k,this;b=a,a=null}if(!b)return this._where=a,this;if(g(b))switch(b.length){case 0:return this._where=k,this;case 1:b=b[0];break;default:return this._where=a?function(){var c,d=b.length,e=a.call(this);for(c=0;d>c;++c)if(b[c]===e)return!0}:function(){var a,c=b.length;for(a=0;c>a;++a)if(b[a]===this)return!0},this}return this._where=a?function(){return b===a.call(this)}:function(){return b===this},this},and:function(a){return new e([this,a])},hasLayer:function(a){return a===this._layer},data:function(){return new r(this.nodes())},inside:function(){},toFront:function(a,b){return d.call(this,a,b,"toFront")},toBack:function(a,b){return d.call(this,a,b,"toBack")},layout:function(){},remove:function(){return this._layer.removeNodeSet(this),this},redraw:function(a){return this._vizlets[0].redraw(this,a),this},vizlets:function(){return this._vizlets},nodes:function(){},revalidate:function(){this._cache&&(this._cache=null)}});a.Layer.SingleNodeSet=a.Layer.NodeSet.extend("aperture.Layer.SingleNodeSet",{init:function(b){a.Layer.NodeSet.prototype.init.call(this,b?b.layer:null),this._node=b},nodes:function(a){var b=this._where,c=this._node;return!c||!c.layer||a&&a!==this._layer||b&&!b.call(c.data)?l:new p(c)}});return a.Layer.LogicalNodeSet=a.Layer.NodeSet.extend("aperture.Layer.LogicalNodeSet",{init:function(b){a.Layer.NodeSet.prototype.init.call(this,b)},nodes:function(a){return a&&a!==this._layer||this._where===k?l:this._where?this._cache?new o(this._cache):new n(this,!0):new m(this._layer.nodes_)}}),e=a.Layer.MultiSet=a.Layer.NodeSet.extend("aperture.Layer.MultiSet",{init:function(a){this._sets=a;var b,c,d,e,f,g=a.length,h={},i=this._vizlets=[];for(b=0;g>b;b++)for(e=a[b].vizlets(),f=e.length,c=0;f>c;c++)d=e[c],h[d.uid]||i.push(h[d.uid]=d)},nodes:function(a){var b,c,d,e=this._sets,f=e.length;for(b=0;f>b;b++)c=e[b],(!a||c.hasLayer(a))&&(d||(d=[])).push(c);return d?new q(d):l},hasLayer:function(a){var b,c=this._sets,d=c.length;
for(b=0;d>b;b++)if(c[b].hasLayer(a))return!0;return!1},where:k,remove:function(){var a,b=this._sets,c=b.length;for(a=0;c>a;a++)b[a].remove();return this},toFront:function(){var a,b=this._sets,c=b.length;for(a=0;c>a;a++)b[a].toFront.apply(b[a],arguments);return this},toBack:function(){var a,b=this._sets,c=b.length;for(a=0;c>a;a++)b[a].toBack.apply(b[a],arguments);return this},redraw:function(a){var b,c=this._vizlets,d=c.length;for(b=0;d>b;b++)c[b].redraw(this,a);return this},revalidate:function(){var a,b=this._sets,c=b.length;for(a=0;c>a;a++)b[a].revalidate()}}),b}(a||{}),a=function(b){b.MapKey=b.Class.extend("aperture.MapKey",{init:function(a,b){this.fromRange=a,this.toArray=b},label:function(a){return arguments.length&&(this.label=a),this.label},from:function(){return this.fromRange},to:function(){return this.toArray}});var c={number:function(a,b,c){return a+c*(b-a)},object:function(a,b,c){return a.blend(b,c)}},d={area:function(a){return Math.sqrt(a)}};return b.ScalarMapKey=b.MapKey.extend("aperture.ScalarMapKey",{init:function(a,d){b.MapKey.prototype.init.call(this,a,d),this.blend=c[typeof d[0]],this.toType="linear"},map:function(a){var b=this.fromRange.map(a),c=this.toArray;switch(b){case 0:return c[0];case 1:return c[c.length-1];default:this.tween&&(b=this.tween(b,a));var d=Math.floor(b*=c.length-1);return this.blend(c[d],c[d+1],b-d)}},type:function(b){if(void 0===b)return this.toType;if(a.util.isFunction(b)){if(0!==b(0)||1!==b(1))throw Error("map key type functions must map a progression from 0 to 1");this.tween=b}else a.util.isString(b)&&(this.tween=d[b]);return this.toType=b,this}}),b.OrdinalMapKey=b.MapKey.extend("aperture.OrdinalMapKey",{map:function(a){return this.toArray[this.fromRange.map(a)%this.toArray.length]},type:function(a){return void 0===a?"ordinal":this}}),b}(a||{}),a=function(d){var e=a.util,f=e.forEach;return d.Mapping=a.Class.extend("aperture.Mapping",{init:function(a){this.property=a,this.filters=[],this.dataAccessor=void 0,this.transformation=void 0},only:function(){return this.hasOwnProperty("filters")||(this.filters=[]),this.hasOwnProperty("dataAccessor")||(this.dataAccessor=void 0),this.hasOwnProperty("transformation")||(this.transformation=void 0),this},from:function(a){if(e.isFunction(a))this.dataAccessor=a;else{if(!e.isString(a))throw new Error("Mapping may only be done from a field name or a function");var d=a.match(b);if(!d)throw new Error('Invalid object field "'+a+'" used for mapping');d=e.map(d,function(a){return"."===a.charAt(a.length-1)?a.slice(0,a.length-1):a}),this.dataAccessor=function(){var a=d.slice();return c.call(this,a,Array.prototype.slice.call(arguments))}}return this},asValue:function(a){return this.dataAccessor=function(){return a},this},using:function(a){return void 0===a?this.transformation:(this.transformation=a,this)},filter:function(a){return a?this.hasOwnProperty("filters")?this.filters.push(a):this.filters=[a]:this.filters=[],this},filterWithout:function(a){this.filters=e.without(this.filters,a)},valueFor:function(a,b){var c;return this.dataAccessor&&(c=this.dataAccessor.apply(a,b||[])),this.value(c,a,b)},value:function(a,b,c){return this.transformation&&(a=this.transformation.map(a)),this.filteredValue(a,b,c)},filteredValue:function(a,b,c){if(this.filters.length){b=b||this;var d=[a].concat(c);f(this.filters,function(c){a=c.apply(b,d),d[0]=a})}return a}}),d}(a||{}),a=function(b){var c=Math.PI/180,d=Math.SQRT2-1,e=1/Math.tan(45*c),f=Math.SQRT1_2,g=function(a){var b=a.x,c=a.y;a.x=b*this.cos-c*this.sin,a.y=b*this.sin+c*this.cos},h=function(){},i=function(a){if(!a)return{angle:0,rotate:h};var b=c*a;return{angle:a,cos:Math.cos(b),sin:Math.sin(b),rotate:g}},j={bloom:function(a,b,g){var h=a*d,i=h*(90>b?Math.tan(.5*c*b)*e:1),j=i*f,k=h*f,l={rx:i,ry:h,rotation:g.angle,largeArcFlag:1,points:[{x:-j,y:-k},{x:j,y:-k}]};return g.rotate(l.points[0]),g.rotate(l.points[1]),l},pie:function(a,b,c,d){var e={rx:a,ry:a,rotation:0,largeArcFlag:b>180?1:0,points:[{x:0,y:-a},{x:0,y:-a}]};return c.rotate(e.points[0]),d.rotate(e.points[1]),e}},k=function(a,b,c){var d=c,e=c?0:1;return b+" "+a.points[e].x+","+a.points[e].y+" A"+a.rx+","+a.ry+" "+a.rotation+" "+a.largeArcFlag+","+c+" "+a.points[d].x+","+a.points[d].y},l=function(a,b){var c=-a+",0",d=a+",0",e=a+","+a;return"M"+c+" A"+e+" 0,0,"+b+" "+d+" A"+e+" 0,0,"+b+" "+c+" z"},m=function(a,b){return a.radius-b.radius},n="none",o={"sector-count":void 0,"start-angle":0,form:"pie","base-radius":0,outline:null,"outline-width":3},p={radius:20,fill:n,opacity:1,stroke:n,"stroke-width":1},q=a.Layer.extend("aperture.RadialLayer",{init:function(b,c){a.Layer.prototype.init.call(this,b,c)},canvasType:a.canvas.VECTOR_CANVAS,render:function(a){var b,c,d,e,f,g,h=a.updates,q=a.transition;for(b=h.length-1;b>=0;b--){e=h[b];var r,s,t=e.data,u=this.valuesFor(o,t),v=u["sector-count"],w=0,x=i(u["start-angle"]),y=u["base-radius"],z=u["outline-width"],A=z&&"none"!==u.outline&&u.outline,B="",C=0,D=j.pie,E=[],F=[],G=!1;void 0===v&&(v=1,G=!0),"bloom"===u.form&&(y=0,D=j.bloom);var H=360/v;for(c=0;v>c&&(!this.valueFor("sector-angle",t,H,c)||2!==++w);c++);for(w=w>1,c=0;v>c;c++){var I,J,K,L=this.valueFor("series-count",t,1,c),M=this.valueFor("sector-angle",t,H,c),N=i(x.angle+M),O=y,P=1===L,Q=[];if(M){for(d=0;L>d;d++)K=G?[d]:[c,d],Q.push(this.valuesFor(p,t,K));for(Q.sort(m),y&&w&&(O=D(y,M,x,N)),d=0;L>d;d++){var R=Q[d].radius,S=Q[d].stroke,T=Q[d]["stroke-width"],U=Q[d].fill,V=A&&d===L-1;0>=R||(C=Math.max(C,R),w?(I=D(y+R,M,x,N),r=J=k(I,"M",1),V&&(B?B+=k(I," L",1):B=J),J+=" L0,0 Z",O?r+=k(O,"L",0)+" Z":r=J):(I=y+R,r=J=l(I,1),O&&(r+=l(O,0)),V&&(B=J)),(U||P&&S)&&F.push({graphic:{path:r,fill:U,opacity:Q[d].opacity,"stroke-width":P?T:0,stroke:P?S:n},series:d,segment:c}),P||S===n||E.push({graphic:{path:J,fill:n,opacity:1,"stroke-width":T,stroke:S},series:d,segment:c}),O=I)}x=N}}for(s=E.length;s-->0;)F.push(E[s]);var W=e.position[0]+this.valueFor("x",e.data,0)*e.width,X=e.position[1]+this.valueFor("y",e.data,0)*e.height,Y=e.userData;f=Y.visuals,g=e.graphics;var Z=F.length,$="t"+W+","+X;if(A){y&&(B+=" "+l(y,0)),B+=" Z";var _={fill:n,stroke:A,"stroke-width":z,opacity:this.valueFor("outline-opacity",e.data,1),transform:$};r=Y.outline,r?(_.path=B,g.attr(r,_,q)):(r=Y.outline=g.path(B),g.toBack(r),g.attr(r,_))}else Y.outline&&(g.remove(Y.outline),Y.outline=null);if(f||(f=Y.visuals=[]),f.length>Z)g.removeAll(f.splice(Z,f.length-Z));else for(;f.length<Z;)r=g.path(),f.push(r);for(s=0;s<F.length;s++)F[s].graphic.transform=$,g.attr(f[s],F[s].graphic,q),g.data(f[s],t,[F[s].segment,F[s].series])}}});return b.RadialLayer=q,b}(a||{}),a=function(b){var c="#8aadec",d=function(a,b){var d=a.node,e=this.valueFor("stroke-width",d.data,1,b),f=this.valueFor("stroke",d.data,"none",b),g=this.valueFor("fill",d.data,c,b),h=this.valueFor("opacity",d.data,1,b),i=d.graphics.rect(a.x,a.y,a.size.width,a.size.height);return d.graphics.attr(i,{fill:g,stroke:f,"stroke-width":null==f?0:e,"stroke-linejoin":"round","fill-opacity":h}),i};return b.BarLayer=a.Layer.extend("aperture.BarLayer",{init:function(b,c){a.Layer.prototype.init.call(this,b,c)},canvasType:a.canvas.VECTOR_CANVAS,render:function(a){var b=this.applyLayout(a.updates);this.updateLayer.call(this,b,a.transition)},applyLayout:function(a){var b,c,d=[];for(b=0;b<a.length;b++){{var e=[],f=a[b],g=this.valueFor("bar-count",f.data,1,b),h=this.valueFor("orientation",f.data,"vertical",c);"vertical"===h?f.height:f.width}for(c=0;g>c;c++){var i=this.valueFor("width",f.data,2,c),j=this.valueFor("length",f.data,0,c),k=this.valueFor("x",f.data,0,c)*f.width,l=this.valueFor("y",f.data,0,c)*f.height,m="vertical"===h?i:j,n="vertical"===h?j:i,o=this.valueFor("bar-visible",f.data,!0,c,b);k+=this.valueFor("offset-x",f.data,0,c),l+=this.valueFor("offset-y",f.data,0,c),0>m&&(k+=m,m=-m),0>n&&(l+=n,n=-n);var p={id:c,x:k+(f.position[0]||0),y:l+(f.position[1]||0),size:{width:m,height:n},strokeWidth:1,orientation:h,visible:o,node:f};e.push(p)}d[b]=e}return d},updateLayer:function(a,b){var e,f;for(e=0;e<a.length;e++){var g=a[e],h=g.length;if(h>0)for(f=0;h>f;f++){var i=g[f],j=i.node;j.userData.bars||(j.userData.bars={});var k=j.userData.bars[f];if(i.visible){var l=i.node.data,m=this.valueFor("stroke",l,"none",f),n=(this.valueFor("bar-layout",l,null,f),i.x),o=i.y,p=i.size,q=2;if(n>j.width+j.position[0]||n+q*p.width<j.position[0])k&&(j.graphics.remove(k),delete j.userData.bars[f]);else if(k){var r=this.valueFor("fill",j.data,c,f),s=this.valueFor("opacity",j.data,1,f);j.graphics.attr(k,{fill:r,stroke:m,x:n,y:o,"fill-opacity":s,"stroke-width":null==m?0:i.strokeWidth,"stroke-linejoin":"round",width:p.width,height:p.height},b)}else k=d.call(this,i,f),j.graphics.data(k,l,[f]),j.userData.bars[f]=k}else k&&(j.graphics.remove(k),delete j.userData.bars[f])}}}}),b}(a||{}),a=function(b){function c(a){return!isNaN(a)}function d(a){var b=Math.pow(10,Math.floor(Math.log(a)*Math.LOG10E));return a/=b,a=2>=a?2:5>=a?5:10,a*b}function e(){a.log.warn("Absolute, logarithmic or symmetric views are inappropriate for time scalars and are intentionally excluded.")}var f=a.util;b.Range=a.Class.extend("aperture.Range",{init:function(a){this.label=a,this.formatter_=new b.Format},name:function(a){return void 0===a?this.label:(null===a?delete this.label:this.label=a,this)},mapKey:function(a){return this.mappedTo(a)},get:function(){return this.range.values&&this.range.values.length?(this.revision!==this.range.revision&&(this.revision=this.range.revision,this.view=this.doView()),this.view):this.range.values},start:function(){return this.get()[0]},end:function(){var a=this.get();return a&&a[a.length-1]},format:function(a){return this.formatter_.format(a)},formatter:function(a){if(null==a)return this.formatter_;if(!a.typeOf||!a.typeOf(b.Format))throw new Error("Range formatter must be a Format object");return this.formatter_=a,this},toString:function(){var a=this.get();return this.label+a?" ["+a.toString()+"]":""}});var g=function(){this.revision++,this.revision===Number.MAX_VALUE&&(this.revision=0)},h=function(){throw new Error("Cannot create a scalar view of a banded scalar!")},i=function(){var a=function(a,b){var c=this.values;c?(a<c[0]&&(c[0]=a,this.revise()),b>c[1]&&(c[1]=b,this.revise())):(this.values=[a,b],this.revise())},b=function(){this.values=null,this.revise()};return function(){return{values:null,revision:0,revise:g,set:a,reset:b}}}();b.Scalar=b.Range.extend("aperture.Scalar",{init:function(a,c){b.Range.prototype.init.call(this,a),this.range=i(),this.revision=0,null!=c&&this.expand(c)},expand:function(a){{var b,d;this.range.values}if(f.isArray(a)){var e=f.filter(f.map(a,Number),c);if(!e.length)return this;b=Math.min.apply(Math,e),d=Math.max.apply(Math,e)}else if(b=d=Number(a),isNaN(b))return this;return this.range.set(b,d),this},reset:function(a){return this.range.reset(),null!=a&&this.expand(a),this},map:function(a){var b=this.get();return b&&null!=a&&(a=Number(a))===a?a<=b[0]?0:a>=b[1]?1:(a-b[0])/(b[1]-b[0]):0},mappedTo:function(c){if(arguments.length>1&&(c=Array.prototype.slice.call(arguments)),0===c.length||f.isNumber(c[0])&&isNaN(c[0]))return void a.log.error("Cannot map a scalar range to array length zero or NaN values.");if(!f.isNumber(c[0])&&!c[0].blend){if(!f.isString(c[0]))return void a.log.error("Mappings of Scalar ranges must map to numbers or objects with a blend function.");c=f.map(c,function(b){return new a.Color(b)})}return new b.ScalarMapKey(this,c)},doView:function(){return this.range.values.slice()}}),b.Scalar.addView("symmetric",{init:function(){this.revision=0},doView:function(){var a=this._base.doView();return Math.abs(a[0])>Math.abs(a[1])?a[1]=-a[0]:a[0]=-a[1],a}}),b.Scalar.addView("absolute",{init:function(){this.revision=0},doView:function(){var a=this._base.doView();return a[1]=Math.max(Math.abs(a[0]),Math.abs(a[1])),a[0]=0,a},map:function(a){return null==a?0:this._base.map.call(this,Math.abs(a))}}),b.Scalar.addView("banded",{init:function(a,b){if(this.revision=0,this.abs=this.log=this.symmetric=h,this.bandSpec={roundTo:this.bandSpec?!1:void 0===b?!0:b},f.isNumber(a))(isNaN(a)||1>a)&&(a=1);else if(a&&a.span&&!isNaN(a.span))this.bandSpec.autoBands=a;else if(f.isArray(a))if(a.length<1)a=1;else{var c,d,e;for(this.bandSpec.bands=a=a.slice(),e=a.length;e-->0;)c=a[e],f.isNumber(c)&&(c={min:c},a.splice(e,1,c)),void 0===c.limit&&void 0!==d&&(c.limit=d),d=c.min}else a=1;this.bandSpec.bands||(this.bandSpec.autoBands=a)},doView:function(){var a=this._base.doView(),b=this.bandSpec.bands;if(f.isNumber(a[0])||(a=this._base.extents),this.bandSpec.autoBands){var c=this.bandSpec.autoBands,e=a[0],g=a[1];if(g===e&&(g=g?g+.1*Math.abs(g):1),this.doBands)b=this.doBands(e,g,c);else{b=[];var h=c.span;(!h||0>h)&&(0>g*e&&(1===c&&(c=2),g>-e?(c*=g/(g-e),e=0):(c*=-e/(g-e),g=0)),h=d((g-e)/c));var i,j=Math.floor(a[0]/h)*h;do i=j,j+=h,b.push({min:i,limit:j});while(j<a[1])}}else{for(var k=0,l=b.length;--l>0;)if(a[1]>b[l].min){for(k=l+1;--k>0&&!(a[0]>=b[k].min););break}b=b.slice(k,l+1)}if(this.bandSpec.roundTo)null!=b[0].min&&(a[0]=b[0].min),null!=b[b.length-1].limit&&(a[1]=b[b.length-1].limit);else{a[0]!==b[0].min&&b.length>1&&(b[0]={min:-Number.MAX_VALUE,limit:b[0].limit,label:b[0].label});var m=b.length-1;a[1]!==b[m].limit&&(b[m]={min:b[m].min,limit:Number.MAX_VALUE,label:b[m].label})}return this.extents=a,b},start:function(){return this.get(),this.extents&&this.extents[0]},end:function(){return this.get(),this.extents&&this.extents[1]},map:function(a){this.get();var b=this.extents;return!b||null==a||isNaN(a=Number(a))?0:a<=b[0]?0:a>=b[1]?1:(a-b[0])/(b[1]-b[0])}}),b.Scalar.addView("quantized",{init:function(){if(!this.typeOf(b.Scalar.prototype.banded))throw new Error("Only banded scalars can be quantized.");this.banded=h,this.revision=0},doView:function(){var a=this._base.doView();if(this.bandSpec.autoBands){for(var b,c,d=[],e=a.length;e-->0;)c=a[e],c.min!==-Math.MAX_VALUE?(b=view.format(c.min),b+=c.limit!==Math.MAX_VALUE?" - "+view.format(c.limit):" +"):b=c.limit!==Math.MAX_VALUE?"< "+view.format(c.limit):"all",d.push({min:c.min,limit:c.limit,label:b});return d}return a},mappedTo:function(a){return b.Ordinal.prototype.mappedTo.call(this,a)},map:function(a){var b=this.get();if(b&&null!=a&&!isNaN(a=Number(a)))for(var c=b.length;c-->0;)if(a>=b[c].min)return c;return 0},format:function(a){return this.get()[this.map(a)].label}}),b.Scalar.addView("logarithmic",{init:function(a){this.revision=0,this.absMin=a||.1},doView:function(){var a=this._base.doView();a[0]<0?(a[0]=Math.min(a[0],-this.absMin),a[1]=a[1]<0?Math.min(a[1],-this.absMin):Math.max(a[1],this.absMin)):(a[0]=Math.max(a[0],this.absMin),a[1]=Math.max(a[1],this.absMin));var b=Math.log(Math.abs(a[0]))*Math.LOG10E,c=Math.log(Math.abs(a[1]))*Math.LOG10E;this.logMin=a[0]*a[1]<0?Math.log(this.absMin)*Math.LOG10E:Math.min(b,c),this.mappedLogMin=0,this.oneOverLogRange=0;var d=b-this.logMin+c-this.logMin;return d&&(this.oneOverLogRange=1/d,this.mappedLogMin=a[0]>=0?0:a[1]<=0?1:(b-this.logMin)*this.oneOverLogRange),a},map:function(a){switch(this._base.map.call(this,a)){case 0:return 0;case 1:return 1}var b=Math.abs(a=Number(a));return this.mappedLogMin+(b<=this.absMin?0:(a>0?1:-1)*(Math.log(b)*Math.LOG10E-this.logMin)*this.oneOverLogRange)}});var j=function(){function a(a,b){a.set({FullYear:Math.floor(a.get("FullYear")/b)*b,Month:0,Date:1,Hours:0,Minutes:0,Seconds:0,MilliSeconds:0})}function b(a,b){a.set({Month:Math.floor(a.get("Month")/b)*b,Date:1,Hours:0,Minutes:0,Seconds:0,MilliSeconds:0})}function c(a){a.set({Date:a.get("Date")-a.get("Day"),Hours:0,Minutes:0,Seconds:0,MilliSeconds:0})}function d(a,b){a.set({Date:1+Math.floor((a.get("Date")-1)/b)*b,Hours:0,Minutes:0,Seconds:0,MilliSeconds:0})}function e(a,b){a.set({Hours:Math.floor(a.get("Hours")/b)*b,Minutes:0,Seconds:0,MilliSeconds:0})}function g(a,b){a.set({Minutes:Math.floor(a.get("Minutes")/b)*b,Seconds:0,MilliSeconds:0})}function h(a,b){a.set({Seconds:Math.floor(a.get("Seconds")/b)*b,MilliSeconds:0})}function i(a,b){a.set({MilliSeconds:Math.floor(a.get("Milliseconds")/b)*b})}{var j,k=[{field:"FullYear",span:316224e5,round:a,steps:[1]},{field:"Month",span:26784e5,round:b,steps:[3,1]},{field:"Date",span:864e5,round:c,steps:[7]},{field:"Date",span:864e5,round:d,steps:[1]},{field:"Hours",span:36e5,round:e,steps:[12,6,3,1]},{field:"Minutes",span:6e4,round:g,steps:[30,15,5,1]},{field:"Seconds",span:1e3,round:h,steps:[30,15,5,1]},{field:"Milliseconds",span:1,round:i,steps:[500,250,100,50,25,10,5,1]}],l=[];Date.prototype}return f.forEach(k,function(a){f.forEach(a.steps,function(b){l.push(j={name:a.field,span:a.span*b,next:j,base:b,round:a.round})})}),l}(),k={Year:"FullYear",Day:"Date"};return b.TimeScalar=b.Scalar.extend("aperture.TimeScalar",{_utc:!0,init:function(a,c){b.Scalar.prototype.init.call(this,a,c),this.formatter_=new b.TimeFormat},banded:function(a,c){var d=b.Scalar.prototype.banded.call(this,a,c);return d.autoFormat=!0,d.get(),d},absolute:e,logarithmic:e,symmetric:e,doBands:function(c,e,f){var g,h,i,l=0;if(f.span){h=!isNaN(f.span)&&f.span>1?f.span:1;var m=k[f.units]||f.units;if(f.units)for(i=j.length;i>l&&(!(j[l].name===m&&(g=j[l]).base<=h)||7===g.base&&7!==h);l++);g||(a.log.error("Invalid units in band specification: "+m),f=1,l=0)}if(!g){var n=Math.max(1,(e-c)/f);for(i=j.length;i>l;l++)if((g=j[l]).span<n){g=g.next||g;break}h=g.next?g.base:Math.max(1,d(n/31536e6))}this.autoFormat&&(this.formatter_=new b.TimeFormat({precision:g.name,local:!this._utc}));var o,p=new a.Date(c,{local:!this._utc}),q=[];for(g.round(p,h);l++<1e3;){var r=p.valueOf();if(o&&(o.limit=r),r>=e)break;q.push(o={min:r}),p.add(h,g.name)}return q}}),b.TimeScalar.addView("local",{init:function(){this._utc=!1,this.formatter_._utc=!1}}),b.TimeScalar.addView("utc",{init:function(){this._utc=!0,this.formatter_._utc=!0}}),b.Ordinal=b.Range.extend("aperture.Ordinal",{init:function(a,c){b.Range.prototype.init.call(this,a),this.range={values:[],revision:0,revise:g},this.revision=0,null!=c&&this.expand(c)},revoke:function(a){if(f.isArray(a)){var b=[this.range.values];this.range.values=f.without.apply(f,b.concat(a))}else this.range.values=f.without(this.range.values,a);return this.range.revise(),this},reset:function(a){return this.range.values=[],this.range.revise(),null!=a&&this.expand(a),this},expand:function(a){var b,c,d=this.range.values,e=(d.length,0);if(f.isArray(a))for(c=a.length;c>e;e++)b=-1===f.indexOf(d,a[e])&&d.push(a[e])||b;else b=-1===f.indexOf(d,a)&&d.push(a);return b&&this.range.revise(),this},mappedTo:function(a){return arguments.length>1&&(a=Array.prototype.slice.call(arguments)),0!==a.length?new b.OrdinalMapKey(this,a):void 0},map:function(a){var b=this.range.values,c=f.indexOf(b,a);return 0>c&&(c=b.length,b.push(a)),c},indexOf:function(a){return f.indexOf(this.range.values,a)},doView:function(){return this.range.values}}),b.Ordinal.addView("banded",{init:function(){this.revision=0},doView:function(){var a=this._base.doView(),b=[],c=a.length,d="";for(b.length=c;c-->0;)b[c]={min:a[c],label:a[c].toString(),limit:d},d=a[c];return b},mappedTo:function(a){return b.Scalar.prototype.mappedTo.call(this,a)},map:function(a){var b=this.get().length;return 0===b?0:this._base.map(a)/b},banded:function(){throw new Error("Cannot create a view of a banded ordinal!")}}),b}(a||{}),a=function(d){var e=a.util,f=a.Class.extend("aperture.Set",{init:function(a){var d,f=this;e.isString(a)&&(d=a.match(b))?(d=e.map(d,function(a){return"."===a.charAt(a.length-1)?a.slice(0,a.length-1):a}),this.idFunction=function(){return c.call(this,d.slice(0),Array.prototype.slice.call(arguments))}):e.isFunction(a)&&(this.idFunction=a),this.filterFn=function(a){return a=f.translateData.call(f,this,Array.prototype.slice.call(arguments,1)),f.contains(a)},this.contents=[]},add:function(a){return this.contains(a)?void 0:(this.contents.push(a),a)},clear:function(){var a=this.contents;return this.contents=[],a},remove:function(a){this.contents=e.without(this.contents,a)},forEach:function(a){e.forEach(this.contents,a)},get:function(a){return this.contents[a]},size:function(){return this.contents.length},toArray:function(){return this.contents.slice()},toggle:function(a){this.contains(a)?this.remove(a):this.add(a)},contains:function(a){return e.indexOf(this.contents,a)>=0},translateData:function(a,b){return this.idFunction?this.idFunction.apply(a,b):a},filter:function(a){return d.filter.conditional(this.filterFn,a)},scale:function(b){return d.filter.conditional(this.filterFn,a.filter.scale(b))},constant:function(b){return d.filter.conditional(this.filterFn,a.filter.constant(b))}});return f.addView("not",{init:function(){var a=this;this.filterFn=function(b){return b=a.translateData.call(a,this,Array.prototype.slice.call(arguments,1)),a.contains(b)}},contains:function(a){return!this._base.contains(a)}}),d.Set=f,d}(a||{}),a=function(b){var c=a.PlotLayer.extend("aperture.NodeLayer",{init:function(b,c){a.PlotLayer.prototype.init.call(this,b,c)},canvasType:a.canvas.VECTOR_CANVAS,render:function(b){var c,d,e,f,g;a.util.forEach(b.updates,function(a){g=a.data,c=this.valueFor("node-x",g,0),d=this.valueFor("node-y",g,0),e=this.valueFor("width",g,1),f=this.valueFor("height",g,1),a.position=[c,d],a.userData.id=g.id,a.width=e,a.height=f},this),a.PlotLayer.prototype.render.call(this,b)}});return b.NodeLayer=c,b.NodeLink=a.vizlet.make(c),b}(a||{}),a=function(b){function c(a,b){var c=a.sx,d=a.sy,e=a.tx,h=a.ty,i=e-c,j=h-d,k=Math.sqrt(i*i+j*j);if(k){var l=a.sr/k,m=a.tr/k;if(1>l+m){var n=i*l,o=j*l,p=-i*m,q=-j*m;if("arc"===b){c+=n*g+o*f,d+=-n*f+o*g,e+=p*g-q*f,h+=p*f+q*g;var r=(c+e)/2+(h-d)/4,s=(d+h)/2+(c-e)/4;return"M"+c+","+d+"Q"+r+","+s+","+e+","+h}return c+=n,d+=o,e+=p,h+=q,"M"+c+","+d+"L"+e+","+h}}return""}function d(a,b){switch(b){case"none":a.opacity=0;case"":case"solid":return"";case"dashed":return"- ";case"dotted":return". "}return b}var e=Math.atan(.5),f=Math.sin(e),g=Math.cos(e);return b.LinkLayer=a.Layer.extend("aperture.LinkLayer",{init:function(b,c){a.Layer.prototype.init.call(this,b,c)},canvasType:a.canvas.VECTOR_CANVAS,render:function(a){var b,e=a.updates,f=e.length,g=a.transition;for(b=0;f>b;b++){var h=e[b],i=h.data,j=this.valueFor("source",i,null),k=this.valueFor("target",i,null),l={sx:this.valueFor("node-x",j,0,i),sy:this.valueFor("node-y",j,0,i),sr:this.valueFor("source-offset",j,0,i),tx:this.valueFor("node-x",k,0,i),ty:this.valueFor("node-y",k,0,i),tr:this.valueFor("target-offset",k,0,i)},m=c(l,this.valueFor("link-style",i,"line")),n={opacity:this.valueFor("opacity",i,1),stroke:this.valueFor("stroke",i,"link"),"stroke-width":this.valueFor("stroke-width",i,1)};n["stroke-dasharray"]=d(n,this.valueFor("stroke-style",i,"")),h.cache?(n.path=m,h.graphics.attr(h.cache,n,g)):(h.cache=h.graphics.path(m),h.graphics.attr(h.cache,n))}}}),b}(a||{}),a=function(b){function c(a,b){switch(b){case"none":a.opacity=0;break;case"":case"solid":return"";case"dashed":return"- ";case"dotted":return". "}return b}function d(a){var b;for(b=0;b<a.length;b++){var c=a[b],d=c.data;g[d.id]&&delete g[d.id]}}function e(b){var c,d={},e={},f=b.length,g=this.mappings()["stroke-width"],h=1;for(g&&g.using()&&(h=g.using().to()[0],h>0&&(g=a.util.viewOf(g),g.using(a.util.viewOf(g.using())),g.using().toArray=g.using().toArray.slice(),g.using().toArray[0]=0)),c=0;f>c;c++){var i=b[c],j=i.data,k=this.valueFor("source",j,null),l=this.valueFor("target",j,null),m=g.valueFor(j)||0,n={source:{uid:this.valueFor("node-uid",k,"",j),duplicateId:this.valueFor("node-id",k,null,j),x:this.valueFor("node-x",k,0,j),y:this.valueFor("node-y",k,0,j),r:this.valueFor("source-offset",k,0,j)},target:{uid:this.valueFor("node-uid",l,"",j),duplicateId:this.valueFor("node-id",l,null,j),x:this.valueFor("node-x",l,0,j),y:this.valueFor("node-y",l,0,j),r:this.valueFor("target-offset",l,0,j)},link:i,width:m},o=d[n.source.uid];null==o&&(o=d[n.source.uid]={outflows:[]}),o.outflows.push(n),o.anchor=this.valueFor("sankey-anchor",k,"top");var p=e[n.target.uid];null==p&&(p=e[n.target.uid]={inflows:[]}),p.inflows.push(n),p.anchor=this.valueFor("sankey-anchor",l,"top")}return a.util.forEach(d,function(a){var b=a.outflows;b.sort(function(a,b){return a.target.y<=b.target.y?-1:1})}),a.util.forEach(e,function(a){var b=a.inflows;b.sort(function(a,b){return a.source.y<=b.source.y?-1:1})}),{sourceMap:d,targetMap:e,minWidth:h}}function f(a,b){var c={x:.5*(b.x+a.x),y:.5*(b.y+a.y)},d="M"+a.x+","+a.y;return d+="C"+c.x+","+a.y+","+c.x+","+b.y+","+b.x+","+b.y}var g={};return b.SankeyPathLayer=a.Layer.extend("aperture.SankeyPathLayer",{init:function(b,c){a.Layer.prototype.init.call(this,b,c)},canvasType:a.canvas.VECTOR_CANVAS,render:function(b){var h,i=b.updates,j=b.transition;b.removed.length>0&&d(b.removed);var k,l,m,n,o,p=e.call(this,i),q=p.sourceMap,r=p.targetMap,s=p.minWidth,t=0,u=[];for(a.util.forEach(r,function(a){var b=a.inflows;if(k=0,"middle"===a.anchor||"bottom"===a.anchor){for(t=0;t<b.length;t++)k-=b[t].width;"middle"===a.anchor&&(k*=.5)}var c={};for(t=0;t<b.length;t++){l=b[t],m=Math.max(s,l.width);var d,e=!0;c.hasOwnProperty(l.source.duplicateId)?(d=c[l.source.duplicateId],e=!1):(d=l.target.y+k+.5*m,null!=l.source.duplicateId&&(c[l.source.duplicateId]=d)),l.targetPt={x:l.target.x-l.target.r,y:d},e&&(k+=l.width)}}),a.util.forEach(q,function(a){var b=a.outflows;if(k=0,"middle"===a.anchor||"bottom"===a.anchor){for(t=0;t<b.length;t++)k-=b[t].width;"middle"===a.anchor&&(k*=.5)}var c={};for(t=0;t<b.length;t++){l=b[t],n=l.targetPt;var d=!0;m=Math.max(s,l.width);var e;c.hasOwnProperty(l.target.duplicateId)?(e=c[l.target.duplicateId],d=!1):(e=l.source.y+k+.5*m,null!=l.target.duplicateId&&(c[l.target.duplicateId]=e)),n&&(o={x:l.source.x+l.source.r,y:e},d&&(k+=l.width),u.push({link:l.link,path:f(o,n),width:m}))}}),h=0;h<u.length;h++){var v=u[h],w=v.link,x=w.data,y={opacity:this.valueFor("opacity",x,1),stroke:this.valueFor("stroke",x,"link"),"stroke-width":v.width};if(y["stroke-dasharray"]=c(y,this.valueFor("stroke-style",x,""))||void 0,g[x.id]){y.path=v.path;var z=g[x.id];w.graphics.attr(z,y,j)}else g[x.id]=w.graphics.path(v.path),w.graphics.attr(g[x.id],y)}}}),b}(a||{}),a.filter=function(b){var c={constant:function(a){return function(){return a}},scale:function(a){return function(b){return b*a}},shift:function(a){return function(b){return b+a}},brighter:function(){},conditional:function(a,b){return function(c){return a.apply(this,arguments)?b.apply(this,arguments):c}}};return a.util.extend(b,c),b}(a.filter||{}),a.io=function(){var b,c="%host%/rest",d=0,e=[];return a.config.register("aperture.io",function(a){c=a["aperture.io"].restEndpoint}),{restUrl:function(a){var b=document.location.origin||document.location.protocol+"//"+document.location.host;return c.replace("%host%",b)+a},rest:function(c,f,g,h){var i=a.io.restUrl(c),j=function(b,c,f){d-=1,a.util.forEach(e,function(a){a.onRequestComplete(d)}),g&&g(b,{success:!0,status:c,xhr:f})},k=function(b,c,f){var h=b.responseText;if(d-=1,a.util.forEach(e,function(a){a.onRequestComplete(d)}),a.log.error((f||c||"unspecified error")+(h?" : "+h:"")),g){var i=b.getResponseHeader("content-type");if(h&&i&&i.indexOf("json")>-1)try{h=jQuery.parseJSON(h)}catch(j){h=null}g(h,{success:!1,status:c,xhr:b,errorThrown:f})}},l={url:i,type:f,success:j,error:k};b&&(i=b(i)),h&&(h.contentType&&(l.contentType=h.contentType),null!=h.async&&(l.async=h.async),h.postData&&"POST"===f&&(l.data=h.postData,l.contentType&&l.contentType.toLowerCase().indexOf("json")>-1&&(l.contentType="application/json; charset=UTF-8",a.util.isString(l.data)||(l.data=JSON.stringify(l.data)))),h.params&&"GET"===f&&(l.data=h.params),h.headers&&(l.headers=h.headers)),d+=1,$.ajax(l)},addRestListener:function(a){a&&"function"!=typeof a||e.push(a)},removeRestListener:function(b){b&&"function"!=typeof b||e.splice(a.util.indexOf(e,b),1)},getPendingRequests:function(){return d},setUrlAuthenticator:function(a){a&&"function"!=typeof a||(b=a)}}}(),a.palette=function(b){function c(a){return null==a?100:20*Math.round(5*Math.max(0,Math.min(1,a)))}function d(a,b){return l.blend(m,a).blend(n.blend(o,a),b)}function e(a,b){return j("/parchment/"+a+"/"+b)}var f={white:"#ffffff",silver:"#c0c0c0",gray:"#808080",black:"#000000",red:"#FF0000",maroon:"#800000",orange:"#ffa500",yellow:"#ffff00",olive:"#808000",lime:"#00ff00",green:"#008000",aqua:"#00ffff",teal:"#008080",blue:"#0000ff",navy:"#000080",fuchsia:"#ff00ff",purple:"#800080"},g={"default":["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"]},h=a.util.viewOf(f),i=g,j=a.io.restUrl,k=a.Color.fromRGB,l=k(248,210,158),m=k(253,231,192),n=k(202,202,202),o=k(255,255,255),p=k(0,0,0);b.color=function(a){return h[a]},b.colors=function(a){return i[a||"default"]},b.size=function(a){return sizes[a]},b.sizes=function(a){return sizeSets[a]},b.parchmentCSS=function(a,b){a=c(a),b=c(b);var f=d(.01*a,.01*b);return{"background-color":f.toString(),"background-image":99>a?"url("+e(a,b)+")":"","border-color":f.blend(p,.25).toString()}},b.parchmentClass=function(a,b){return"aperture-parchment-"+c(a)+"-"+c(b)},b.asLESS=function(){var b="// Generated Aperture Palette Export for LESS CSS\n\n// COLORS (excluding CSS 2.1)\n";return a.util.forEach(h,function(a,c){b+="@"+c+": "+a+";\n"}),b+="\n// COLOR SETS\n",a.util.forEach(i,function(c,d){var e="@"+d+"-";a.util.forEach(c,function(a,c){b+=e+c+": "+a+";\n"})}),b},a.config.register("aperture.palette",function(b){var c=b["aperture.palette"];if(c){var d,e=c.color;if(e)for(d in e)e.hasOwnProperty(d)&&d.toLowerCase&&(d=d.toLowerCase(),h[d]=e[d]);c.colors&&a.util.forEach(c.colors,function(a,b){i[b]=a.slice()})}});var q=encodeURIComponent,r=!(!window.SVGAngle&&!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")),s=!0;return b.icon=function(b){var c=b.format,d=b.attributes,e="/icon/"+q(b.ontology||"aperture-hscb")+"/"+q(b.type)+"?iconWidth="+(b.width||24)+"&iconHeight="+(b.height||24);return c&&(r||"svg"!==c.toLowerCase()||(s&&(a.log.warn("SVG icon format requested but this browser doesn't support it. Using PNG."),s=!1),c="png"),e+="&iconFormat="+c),a.util.forEach(d,function(a,b){e+="&"+q(b)+"="+q(a)}),j(e)},b}(a.palette||{}),a.log=function(b){var c=a.log.Appender.extend({init:function(b){b=b||{},a.log.Appender.prototype.init.call(this,b.level||a.log.LEVEL.WARN),this.url=b.url,this.buffer=[],this.postData=a.util.bind(this.postData,this),setInterval(this.postData,b.timeout||3e3),$(window).unload(this.postData)},logString:function(a,b){this.buffer.push({level:a,message:b,when:new Date})},logObjects:function(a,b){this.buffer.push({level:a,data:b,when:new Date})},postData:function(){this.buffer.length&&($.ajax({url:this.url,type:"POST",data:this.buffer}),this.buffer=[])}});return b.addAjaxAppender=function(a){return b.addAppender(new c(a))},b}(a.log||{}),a.log=function(b){var c=a.log.Appender.extend({init:function(b){b=b||{},a.log.Appender.prototype.init.call(this,b.level||a.log.LEVEL.ERROR)},logString:function(a,b){alert(a.toUpperCase()+":\n"+b)}});return b.addAlertBoxAppender=function(a){return b.addAppender(new c(a))},b}(a.log||{}),a.log=function(b){var c=a.log.Appender.extend({init:function(b){b=b||{},a.log.Appender.prototype.init.call(this,b.level||a.log.LEVEL.INFO),this.depth=b.bufferDepth||100,this.buffer=[]},logString:function(a,b){this.buffer.push({level:a,message:b,when:new Date}),this.buffer.length>this.depth&&this.buffer.shift()},logObjects:function(a,b){this.buffer.push({level:a,objects:b,when:new Date}),this.buffer.length>this.depth&&this.buffer.shift()},getBuffer:function(a){var b=this.buffer;return a||(this.buffer=[]),b}});return b.addBufferingAppender=function(a){return b.addAppender(new c(a))},b}(a.log||{}),a.log=function(b){var c=a.log.Appender.extend({init:function(b){b=b||{},a.log.Appender.prototype.init.call(this,b.level||a.log.LEVEL.INFO),this.map=[],a.util.forEach(a.log.LEVEL,function(a){this.map[a]=function(){var b=window.console;"undefined"!=typeof b&&("object"==typeof b.log?b[a]?Function.prototype.apply.call(b[a],b,arguments):Function.prototype.apply.call(b.log,b,arguments):b.firebug?b[a].apply(window,arguments):b[a]?b[a].apply(b,arguments):b.log.apply(b,arguments))
}},this)},logString:function(a,b){this.map[a](b)},logObjects:function(a,b){this.map[a].apply(null,b)}});return b.addConsoleAppender=function(a){return b.addAppender(new c(a))},b}(a.log||{}),a.log=function(b){var c=a.log.Appender.extend({init:function(b){b=b||{},a.log.Appender.prototype.init.call(this,b.level||a.log.LEVEL.INFO);var c=this.list=$('<ol class="aperture-log-display"></ol>').appendTo(b.container);$('<button class="aperture-log-clear" type="button">Clear</button>').click(function(){c.empty()}).appendTo(b.container)},logString:function(a,b){$("<li></li>").text("["+a+"] "+b).addClass("aperture-log-"+a).appendTo(this.list)}});return b.addDomAppender=function(a){return b.addAppender(new c(a))},b}(a.log||{}),a.log=function(b){var c=a.log.Appender.extend({init:function(b){a.log.Appender.prototype.init.call(this,b&&b.level||a.log.LEVEL.ERROR);var c=null,d=b&&b.parentId;if(d&&a.util.isString(d)&&("#"!==d.charAt(0)&&(d="#"+d),c=$(d)),(null==c||0===c.length)&&(c=$("body")),this._panel=$(".aperture-log-notify",c),0===this._panel.length){var e=this._panel=$('<div class="aperture-log-notify"></div>').appendTo(c).css("display","none"),f=$('<ol class="aperture-log-notify-scrollpane"></ol>').appendTo(e),g=$('<ol class="aperture-log-notify-list"></ol>').appendTo(f);$('<button type="button"></button>').addClass("aperture-log-notify-button").addClass("aperture-log-notify-close").appendTo(e).click(function(){e.css("display","none"),$(".aperture-log-new",e).removeClass("aperture-log-new").addClass("aperture-log-old")}),$('<button type="button"></button>').addClass("aperture-log-notify-button").addClass("aperture-log-notify-clear").appendTo(e).click(function(){g.empty()})}},logString:function(a,b){var c=this._panel;"none"===c.css("display")&&c.css("display","");var d=$(".aperture-log-notify-scrollpane",c),e=$(".aperture-log-notify-list",c),f=e.children();1e3===f.length&&f.first().remove();var g=($("<li></li>").text("["+a+"] "+b).addClass("aperture-log-new").addClass("aperture-log-"+a).appendTo(e),Math.max(0,e.outerHeight()-d.outerHeight()));d.scrollTop(g)}});return b.addNotifyAppender=function(a){return b.addAppender(new c(a))},b}(a.log||{}),a.capture=function(){var b=function(a){return function(b,c){c.success?a(b,c):a(null,c)}};return{initialize:function(){a.io.rest("/capture/start","GET")},store:function(c,d,e,f){var g="";d&&(g+="&"+$.param(d)),e&&(g+="&"+$.param(e));var h="/capture/store?page="+encodeURIComponent(c)+g;a.io.rest(h,"GET",b(f))},inline:function(b,c,d){var e="";return c&&(e+="&"+$.param(c)),d&&(e+="&"+$.param(d)),a.io.restUrl("/capture/inline?page="+encodeURIComponent(b)+e)}}}(),a.layout=function(b){function c(a,b){var c={};return e.forEach(b,function(b){void 0!==a[b]&&(c[b]=a[b])}),c}function d(b,d,h,i,j){function k(b){a.util.forEach(b.nodes,function(a){var b=l[a.id];b&&(b.x=a.x,b.y=a.y,b.tag=a.tag)}),j&&j.apply(this,arguments)}e.isFunction(i)?(j=i,i=void 0):e.isArray(i)||(i?(i.type=b,i=[i]):i={type:b});var l={},m=a.util.map(d.nodes,function(a){return l[a.id]=a,c(a,f)}),n=a.util.map(d.links,function(a){return c(a,g)});a.io.rest("/layout","POST",k,{postData:{nodes:m,links:n,defaultNodeSize:d.defaultNodeSize,extents:h,layout:i},contentType:"application/json"})}var e=a.util,f=["id","x","y","width","height","weight","tag"],g=["sourceId","targetId"];return b.circle=function(a,b,c,e){d("circle",a,b,c,e)},b.radial=function(a,b,c,e){d("radial",a,b,c,e)},b.organic=function(a,b,c,e){d("organic",a,b,c,e)},b.vtree=function(a,b,c,e){d("vtree",a,b,c,e)},b.htree=function(a,b,c,e){d("htree",a,b,c,e)},b.tag=function(a,b,c,e){d("tag",a,b,c,e)},b.multipass=function(a,b,c,e){d(null,a,b,c,e)},b}(a.layout||{}),a.pubsub=function(){function b(b,c){return window.OpenAjax&&OpenAjax.hub?OpenAjax.hub[b].apply(OpenAjax.hub,Array.prototype.slice.call(c,0)):void a.log.error("An OpenAjax hub is required for aperture.pubsub, such as that provided by OpenAjaxUnmanagedHub.js.")}return{publish:function(){return b("publish",arguments)},subscribe:function(){return b("subscribe",arguments)},unsubscribe:function(){return b("unsubscribe",arguments)}}}(),a.store=function(){function b(b,c,d){var e=this.url(b,d);if(e){var f=c&&function(a,d){d.success?c(a,b):c(null,b)};a.io.rest(e,"GET",f)}else c(null,b)}var c={store:function(b,c,d){var e=d&&function(a,b){if(b.success){var c=b.xhr&&b.xhr.getResponseHeader&&b.xhr.getResponseHeader("Location");d({id:a.id,rev:a.rev,store:a.store,url:c})}else d(null)};c=a.util.extend({store:"aperture"},c);var f=c.contentType||a.util.isString(b)&&"text/plain"||"application/json",g="/cms/"+c.store;c.id&&(g+="/"+c.id),c.rev&&(g+="?rev="+c.rev),a.io.rest(g,"POST",e,{postData:b,contentType:f})},url:function(b,c,d){if(!b||null==b.id||""===b.id)return void a.log.error("get from store must specify an id");b.store=b.store||"aperture";var e=a.io.restUrl("/cms/"+b.store+"/"+b.id+"?action="+(c||"get"));return b.rev&&(e+="&rev="+b.rev),d&&(e+="&downloadAs="+encodeURI(d)),e},get:function(a,c){return b(a,c,"get")},remove:function(a,c,d){return b(a,c,d?"pop":"remove")}};return c.getURL=c.url,c}(),a.geo=function(b){function c(){function c(){this.trigger("zoom",{eventType:"zoom",layer:this})}function d(){this.trigger("panend",{eventType:"panend",layer:this})}a.log.info("Loading ESRI map api implementation...");var e=require("esri/SpatialReference"),f=require("esri/geometry/Extent"),g=require("esri/geometry/Point"),h=require("esri/map"),i=require("esri/layers/ArcGISDynamicMapServiceLayer"),j=a.util,k="ESRI_CANVAS";define("ApertureEsriTMSLayer",["dojo/_base/declare","esri/SpatialReference","esri/geometry/Extent","esri/layers/TileInfo","esri/layers/TiledMapServiceLayer"],function(b,c,d,e,f){return b(f,{constructor:function(b){if("undefined"==typeof b.esriOptions)return a.log.error("Esri options must be specfied for Esri TMS layers");if("undefined"!=typeof b.esriOptions.wkid&&(this.spatialReference=new c({wkid:b.wkid}),"undefined"!=typeof b.extent)){var f=b.extent;f.spatialReference=this.spatialReference;var g=new d(f);this.initialExtent=this.fullExtent=g}if(this.urlPrefix=b.urlPrefix,this.urlVersion=b.urlVersion,this.urlLayer=b.urlLayer,this.urlType=b.urlType,this.maxScale=b.esriOptions.maxScale,this.minScale=b.esriOptions.minScale,this.opacity=b.esriOptions.opacity,"undefined"!=typeof b.esriOptions.tiles&&"undefined"!=typeof b.esriOptions.lods){var h=b.esriOptions.tiles;h.lods=b.esriOptions.lods,this.tileInfo=new e(h)}this.loaded=!0,this.onLoad(this)},getTileUrl:function(a,b,c){return b=Math.pow(2,a)-b-1,this.urlPrefix+"/"+this.urlVersion+"/"+this.urlLayer+"/"+a+"/"+c+"/"+b+this.urlType}})});var l=a.canvas.Canvas.extend("aperture.geo.EsriCanvas",{init:function(b,c){a.canvas.Canvas.prototype.init.call(this,b),this.esriMap_=c}});a.canvas.handle(k,l);var m=a.Layer.extend("[private].EsriMapLayer",{init:function(b,c){if(a.Layer.prototype.init.call(this,b,c),b.extent&&(b.extent=OpenLayers.Bounds.fromArray(b.extent)),!this.canvas_)throw new Error("Map layer must be constructed by a parent layer through an addLayer call")},esriLayer_:null,canvasType:k,data:function(a){if(a)throw new Error("Cannot add data to a base map layer")},render:function(){},remove:function(){a.Layer.prototype.remove.call(this)}}),n={tms:"TMS",wms:"WMS"},o=m.extend("aperture.geo.MapTileLayer",{init:function(a,b){m.prototype.init.call(this,a,b),a.options=a.options||{},null==a.options.isBaseLayer&&(a.options.isBaseLayer=!1)}});b.MapTileLayer=o,b.MapTileLayer.TMS=o.extend("aperture.geo.MapTileLayer.TMS",{init:function(a,b){o.prototype.init.call(this,a,b);var c=require("ApertureEsriTMSLayer");this.esriLayer=new c(a),this.canvas_.esriMap_.addLayer(this.esriLayers)}});var p=(function(){function b(a){var b;switch(a){case"click":case"dblclick":b="stopClick";break;case"mousedown":case"touchstart":b="stopDown";break;case"mouseup":b="stopUp"}return b?function(c){this.handler_[b]=this.trigger(a,{data:c.attributes,eventType:a})}:function(b){this.trigger(a,{data:b.attributes,eventType:a})}}var c={mouseout:"out",mouseover:"over"};return function(d){var e,f={};this.handler_&&(this.handler_.deactivate(),this.handler_=null),a.util.forEach(d,function(a,d){f[c[d]||d]=b(d),e=!0})}}(),function(a){var b=a.contentFrame,c=a.mapCanvas.esriMap_,d=c.geographicExtent,f=new e(4326),h=new g(d.xmin,d.ymax,f),i=new g(d.xmax,d.ymin,f),j=(c.toScreen(h),c.toScreen(i)),k=3*j.y,l=3*j.x;j.x=-1*j.x,j.y=-1*j.y,a.corrective={x:j.x,y:j.y};var m={h:k,w:l};a._canvasWidth=m.w,a._canvasHeight=m.h,OpenLayers.Util.modifyDOMElement(b,null,a.corrective,m,"absolute"),a.corrective.x=-1*a.corrective.x,a.corrective.y=-1*a.corrective.y}),q=a.PlotLayer.extend("aperture.geo.MapNodeLayer",{init:function(b,c){if(this.robId="MapNodeLayer",a.PlotLayer.prototype.init.call(this,b,c),c&&c.map&&(this.canvas_.esriMap_=c.map),this.mapCanvas=this.canvas_,!this.mapCanvas.esriMap_)return void a.log.error("MapNodeLayer must be added to a map.");var d=this,e=document.getElementById("map_container");this.contentFrame=document.createElement("div"),this.contentFrame.style.position="absolute",e.appendChild(this.contentFrame),this.mapCanvas.esriMap_.on("load",function(){d.mapCanvas.esriMap_.graphics.enableMouseEvents(),p(d)});var f=function(){p(d),d.contentFrame.style.visibility="visible",d.all().redraw()},g=function(){d.contentFrame.style.visibility="hidden"},h=function(a){var b=a.delta.y-d.corrective.y,c=a.delta.x-d.corrective.x;d.contentFrame.style.top=b+"px",d.contentFrame.style.left=c+"px"};this.mapCanvas.esriMap_.on("zoom-start",g),this.mapCanvas.esriMap_.on("zoom-end",f),this.mapCanvas.esriMap_.on("pan-end",f),this.mapCanvas.esriMap_.on("pan",h);var i=a.canvas.type(a.canvas.VECTOR_CANVAS);this.canvas_=new i(this.contentFrame),this.mapCanvas.canvases_.push(this.canvas_)},update:function(){p(this)},canvasType:k,render:function(b){a.util.forEach(b.updates,function(a){var b=this.valueFor("latitude",a.data,null),c=this.valueFor("longitude",a.data,null),d={x:0,y:0};if(null!=b&&null!=c){var e=new g(c,b,r);d=this.vizlet_.esriMap_.toScreen(e),d.x+=this.corrective.x,d.y+=this.corrective.y}a.position=[d.x,d.y],a.userData.width=this._canvasWidth,a.userData.height=this._canvasHeight},this),a.PlotLayer.prototype.render.call(this,b)},renderChild:function(b,c){a.util.forEach(c.updates,function(a){a&&(a.width=a.parent.userData.width,a.height=a.parent.userData.height)}),b.render(c)},getXY:function(a,b){var c=new g(a,b,r),d=this.vizlet_.esriMap_.toScreen(c);return d},getExtent:function(){return{left:0,right:0,top:0,bottom:0}}});b.MapNodeLayer=q;var r=new e(4326),s={options:{projection:r,displayProjection:r}},t=a.PlotLayer.extend("aperture.geo.EsriMapVizletLayer",{init:function(b,e){this.spec=b=j.extend({},b),a.PlotLayer.prototype.init.call(this,b,e),b.options=j.extend({},s.options||{},b.options),j.isString(b.options.projection)&&(b.options.projection=new OpenLayers.Projection(b.options.projection)),j.isString(b.options.displayProjection)&&(b.options.displayProjection=new OpenLayers.Projection(b.options.displayProjection)),j.isArray(b.options.maxExtent)&&(b.options.maxExtent=OpenLayers.Bounds.fromArray(b.options.maxExtent)),(j.isString(b.options.controls)||j.isArray(b.options.controls)&&0===b.options.controls.length)&&(b.options.controls=[]),b.baseLayer=j.extend({},s.baseLayer||{},b.baseLayer),this.esriMap_=new h("map",s.esriOptions),this.canvas_.canvases_.push(new l(this.canvas_.root(),this.esriMap_)),this.basemapLayer=new i("http://192.168.0.152:6080/arcgis/rest/services/Natural_Earth_SERVICE_BLACK_WM/Natural_Earth_SERVICE_BLACK_WM/MapServer"),this.esriMap_.addLayer(this.basemapLayer);var f="",g=null;for(f in b.baseLayer)if(b.baseLayer.hasOwnProperty(f)){g=b.baseLayer[f];break}if(g){g.options=g.options||{},g.options.isBaseLayer=!0;var k=n[f]||f;o[k]?this.addLayer(o[k],{},g):a.log.warn("WARNING: unrecognized map base layer type: "+f)}else;var m=this;this.esriMap_.on("zoom-end",function(){c.apply(m)}),this.esriMap_.on("pan-end",function(){d.apply(m)})},canvasType:a.canvas.DIV_CANVAS,zoomToMaxExtent:function(){},setOpacity:function(a){this.basemapLayer&&this.basemapLayer.setOpacity(a)},getOpacity:function(){return this.basemapLayer?this.basemapLayer.opacity:-1},on:function(a,b){return this.esriMap_.on(a,b)},getExtent:function(){var a=null;return this.esriMap_.extent&&(a={},a.left=this.esriMap_.extent.xmin,a.bottom=this.esriMap_.extent.ymin,a.right=this.esriMap_.extent.xmax,a.top=this.esriMap_.extent.ymax),a},zoomIn:function(){var a=this.esriMap_.getMaxZoom(),b=this.esriMap_.getZoom();-1!==a&&a>b&&this.esriMap_.setZoom(b+1)},zoomOut:function(){var a=this.esriMap_.getMinZoom(),b=this.esriMap_.getZoom();-1!==a&&b>a&&this.esriMap_.setZoom(b-1)},getZoom:function(){return this.esriMap_.getZoom()},zoomTo:function(a,b,c){var d=new g(b,a,r);this.esriMap_.centerAndZoom(d,c)},setExtents:function(a,b,c,d){var g=new f(a,d,c,b,new e({wkid:4326}));this.esriMap_.setExtent(g)}}),u=a.vizlet.make(t);b.Map=u,a.config.register("aperture.map",function(b){b["aperture.map"]&&(b["aperture.map"].defaultMapConfig&&j.extend(s,b["aperture.map"].defaultMapConfig),a.log.info("Map configuration set."))})}return a.config.register("aperture.map",function(a){if(a["aperture.map"]&&a["aperture.map"].defaultMapConfig){var b=a["aperture.map"].defaultMapConfig.mapType;"esri"===(b&&b.toLowerCase())&&c()}}),b}(a.geo||{}),a.geo=function(b){function c(){function c(){this.trigger("zoom",{eventType:"zoom",layer:this})}function d(){this.trigger("panend",{eventType:"panend",layer:this})}if(!window.OpenLayers)return void a.log.info("OpenLayers js not present. Skipping default map api implementation.");a.log.info("Loading OpenLayers map api implementation...");var e=a.util,f="OPEN_LAYERS_CANVAS",g=function(a){var b,c=a.layers;for(b=0;b<c.length;b++)if(c[b].isBaseLayer===!0)return b},h=a.canvas.Canvas.extend("aperture.geo.OpenLayersCanvas",{init:function(b,c){a.canvas.Canvas.prototype.init.call(this,b),this.olMap_=c}});a.canvas.handle(f,h);var i=a.Layer.extend("[private].OpenLayersMapLayer",{init:function(b,c){if(a.Layer.prototype.init.call(this,b,c),b.extent&&(b.extent=OpenLayers.Bounds.fromArray(b.extent)),!this.canvas_)throw new Error("Map layer must be constructed by a parent layer through an addLayer call");void 0===this.canvas_.olMap_&&(this.canvas_.olMap_=b.parent.olMap_)},olLayer_:null,canvasType:f,data:function(a){if(a)throw new Error("Cannot add data to a base map layer")},render:function(){},remove:function(){a.Layer.prototype.remove.call(this),this.canvas_.olMap_.removeLayer(this.olLayer_)}}),j={tms:"TMS",wms:"WMS"},k=i.extend("aperture.geo.MapTileLayer",{init:function(a,b){i.prototype.init.call(this,a,b),a.options=a.options||{},null==a.options.isBaseLayer&&(a.options.isBaseLayer=!1)}});b.MapTileLayer=k,b.MapTileLayer.TMS=k.extend("aperture.geo.MapTileLayer.TMS",{init:function(a,b){k.prototype.init.call(this,a,b),this.olLayer_=new OpenLayers.Layer.TMS(a.name||"TMS "+this.uid,[a.url],a.options),this.canvas_.olMap_.addLayer(this.olLayer_)}}),b.MapTileLayer.WMS=k.extend("aperture.geo.MapTileLayer.WMS",{init:function(a,b){k.prototype.init.call(this,a,b),this.olLayer_=new OpenLayers.Layer.WMS(a.name||"WMS "+this.uid,a.url,a.options),this.canvas_.olMap_.addLayer(this.olLayer_)}}),b.MapTileLayer.Google=k.extend("aperture.geo.MapTileLayer.Google",{init:function(a,b){if(k.prototype.init.call(this,a,b),this.olLayer_=new OpenLayers.Layer.Google(a.name||"Google "+this.uid,a.options),this.canvas_.olMap_.addLayer(this.olLayer_),a.options.type="styled"){var c=new google.maps.StyledMapType(a.options.style,{name:"Styled Map"});this.olLayer_.mapObject.mapTypes.set("styled",c),this.olLayer_.mapObject.setMapTypeId("styled")}}}),b.MapTileLayer.Bing=k.extend("aperture.geo.MapTileLayer.Bing",{init:function(a,b){k.prototype.init.call(this,a,b),a.options.name=a.options.name||a.name||"Bing "+this.uid,this.olLayer_=new OpenLayers.Layer.Bing(a.options),this.canvas_.olMap_.addLayer(this.olLayer_)}}),b.MapTileLayer.Image=k.extend("aperture.geo.MapTileLayer.Image",{init:function(a,b){k.prototype.init.call(this,a,b);var c=a.options;if(a.size&&(a.size=new OpenLayers.Size(a.size[0],a.size[1])),!c.isBaseLayer&&(c.resolutions||(c.resolutions=this.canvas_.olMap_.layers[g(this.canvas_.olMap_)].resolutions),c.maxResolution||(c.maxResolution=c.resolutions[0]),a.projection)){var d=new OpenLayers.Projection(a.projection),e=new OpenLayers.Projection(this.canvas_.olMap_.projection.projCode);a.extent=a.extent.clone().transform(d,e)}this.olLayer_=new OpenLayers.Layer.Image(a.name||"Image "+this.uid,a.url,a.extent,a.size,c),this.canvas_.olMap_.addLayer(this.olLayer_)}});var l=i.extend("[private].BlankMapLayer",{init:function(a,b){i.prototype.init.call(this,a,b),this.olLayer_=new OpenLayers.Layer("BlankBase"),this.olLayer_.isBaseLayer=!0,this.olLayer_.extent=a.baseLayer.extent||a.options.extent||a.options.maxExtent,this.canvas_.olMap_.addLayer(this.olLayer_)}}),m={fillColor:"fill",fillOpacity:"opacity",strokeColor:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeLinecap:"stroke-linecap",strokeDashstyle:"stroke-style",label:"label",pointRadius:"radius",cursor:"cursor",externalGraphic:""},n={fillColor:"#999999",fillOpacity:"1",strokeColor:"#333333",strokeOpacity:"1",strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",graphicZIndex:0,label:"",pointRadius:0,cursor:""},o={fontFamily:"Arial, Helvetica, sans-serif",fontSize:10},p=function(){function b(a){var b;switch(a){case"click":case"dblclick":b="stopClick";break;case"mousedown":case"touchstart":b="stopDown";break;case"mouseup":b="stopUp"}return b?function(c){this.handler_[b]=this.trigger(a,{data:c.attributes,eventType:a})}:function(b){this.trigger(a,{data:b.attributes,eventType:a})}}var c={mouseout:"out",mouseover:"over"};return function(d){var e,f={};this.handler_&&(this.handler_.deactivate(),this.handler_=null),a.util.forEach(d,function(a,d){f[c[d]||d]=b(d),e=!0}),e&&(this.handler_=new OpenLayers.Handler.Feature(this,this._layer,f,{map:this.canvas_.olMap_,stopClick:!1,stopDown:!1,stopUp:!1}),this.handler_.activate())}}(),q=a.Layer.extend("aperture.geo.MapGISLayer",{init:function(b,c){a.Layer.prototype.init.call(this,b,c);var d=b.name||"External_"+this.uid,f={strategies:[new OpenLayers.Strategy.Fixed],projection:b.projection||t.projCode,protocol:new OpenLayers.Protocol.HTTP({url:b.url,format:new OpenLayers.Format[b.format]({extractAttributes:!0,maxDepth:2})})};this._layer=new OpenLayers.Layer.Vector(d,f),this.canvas_&&this.canvas_.olMap_.addLayer(this._layer);var g=e.extend({},o);e.forEach(m,function(a,b){g[b]="${"+b+"}"});var h=e.extend({},g),i=e.extend({},g),j={},k=this;e.forEach(m,function(a,b){j[b]=function(c){return k.valueFor(a,c.attributes,n[b])}}),j.externalGraphic=function(a){return"OpenLayers.Geometry.Point"===a.geometry.CLASS_NAME?k.valueFor("icon-url",a.attributes,""):k.valueFor("fill-pattern",a.attributes,"")};var l=new OpenLayers.StyleMap({"default":new OpenLayers.Style(g,{context:j}),select:new OpenLayers.Style(h,{context:j}),highlight:new OpenLayers.Style(i,{context:j})});this._layer.styleMap=l},canvasType:f,data:function(a){if(a)throw new Error("Cannot add data to a layer with an external data source")},on:function(b,c){var d=this.handlers_[b];a.Layer.prototype.on.call(this,b,c),d||p.call(this,this.handlers_)},off:function(b,c){a.Layer.prototype.off.call(this,b,c),this.handlers_[b]||p.call(this,this.handlers_)},render:function(){this._layer.redraw()}});b.MapGISLayer=q;var r=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,topLeftPixelLocation:null,initialize:function(){OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.contentFrame=document.createElement("div"),this.contentFrame.style.overflow="hidden",this.contentFrame.style.position="absolute",this.div.appendChild(this.contentFrame)},destroy:function(){OpenLayers.Layer.prototype.destroy.apply(this,arguments)},moveTo:function(a){var b,c;OpenLayers.Layer.prototype.moveTo.apply(this,arguments),b=this.map.getLayerPxFromLonLat(new OpenLayers.LonLat(a.left,a.top)),c=this.map.getLayerPxFromLonLat(new OpenLayers.LonLat(a.right,a.bottom));var d=c.x-b.x,e=c.y-b.y;this.olLayerOrigin={x:b.x-d,y:b.y-e},this.contentFrame.style.top=this.olLayerOrigin.y+"px",this.contentFrame.style.left=this.olLayerOrigin.x+"px",this.contentFrame.style.width=3*d+"px",this.contentFrame.style.height=3*e+"px",this.onFrameChange&&this.onFrameChange(a)},getContentPixelForLonLat:function(a,b){var c=new OpenLayers.Geometry.Point(a,b);this.map.projection!==t&&c.transform(t,this.map.projection);var d=this.map.getLayerPxFromLonLat(new OpenLayers.LonLat(c.x,c.y));return d.x-=this.olLayerOrigin.x,d.y-=this.olLayerOrigin.y,d},getLonLatExtent:function(){var a=this.map.getExtent(),b=new OpenLayers.Geometry.Point(a.left,a.top),c=new OpenLayers.Geometry.Point(a.right,a.bottom);return this.map.projection!==t&&(b.transform(this.map.projection,t),c.transform(this.map.projection,t)),{left:b.x,top:b.y,right:c.x,bottom:c.y}},drawFeature:function(){},CLASS_NAME:"DivOpenLayer"}),s=a.PlotLayer.extend("aperture.geo.MapNodeLayer",{init:function(b,c){a.PlotLayer.prototype.init.call(this,b,c);var d=this.canvas_;if(!d.olMap_)return void a.log.error("MapNodeLayer must be added to a map.");this._layer=new r(b.name||"NodeLayer_"+this.uid,{}),d.olMap_.addLayer(this._layer),this._layer.setZIndex(999),this._layer.div.style.pointerEvents="none";var e=a.canvas.type(a.canvas.VECTOR_CANVAS);this.canvas_=new e(this._layer.contentFrame),d.canvases_.push(this.canvas_);var f=this;this._canvasWidth=this.canvas_.root_.offsetWidth,this._canvasHeight=this.canvas_.root_.offsetHeight,this._layer.onFrameChange=function(){f._canvasWidth=f.canvas_.root_.offsetWidth,f._canvasHeight=f.canvas_.root_.offsetHeight,f.all().redraw()}},canvasType:f,render:function(b){a.util.forEach(b.updates,function(a){var b=this.valueFor("latitude",a.data,null),c=this.valueFor("longitude",a.data,null),d={x:0,y:0};null!=b&&null!=c&&(d=this._layer.getContentPixelForLonLat(c,b)),a.position=[d.x,d.y],a.userData.width=this._canvasWidth,a.userData.height=this._canvasHeight},this),a.PlotLayer.prototype.render.call(this,b)},renderChild:function(b,c){a.util.forEach(c.updates,function(a){a&&(a.width=a.parent.userData.width,a.height=a.parent.userData.height)}),b.render(c)},getXY:function(a,b){var c=new OpenLayers.LonLat(a,b);return this._layer.map.projection!==t&&c.transform(t,this._layer.map.projection),this._layer.map.getViewPortPxFromLonLat(c)},getExtent:function(){return this._layer.getLonLatExtent()}});b.MapNodeLayer=s;var t=new OpenLayers.Projection("EPSG:4326"),u={options:{projection:t,displayProjection:t}},v=a.PlotLayer.extend("aperture.geo.MapVizletLayer",{init:function(b,f){this.spec=b=e.extend({},b),a.PlotLayer.prototype.init.call(this,b,f),b.options=e.extend({},u.options||{},b.options),e.isString(b.options.projection)&&(b.options.projection=new OpenLayers.Projection(b.options.projection)),e.isString(b.options.displayProjection)&&(b.options.displayProjection=new OpenLayers.Projection(b.options.displayProjection)),e.isArray(b.options.maxExtent)&&(b.options.maxExtent=OpenLayers.Bounds.fromArray(b.options.maxExtent)),(e.isString(b.options.controls)||e.isArray(b.options.controls)&&0===b.options.controls.length)&&(b.options.controls=[]),b.baseLayer=e.extend({},u.baseLayer||{},b.baseLayer),this.olMap_=new OpenLayers.Map(b.options),this.canvas_.canvases_.push(new h(this.canvas_.root(),this.olMap_));var g="",i=null;for(g in b.baseLayer)if(b.baseLayer.hasOwnProperty(g)){i=b.baseLayer[g];break}if(i){i.options=i.options||{},i.options.isBaseLayer=!0;var m=j[g]||g;k[m]?this.addLayer(k[m],{},i):(a.log.warn("WARNING: unrecognized map base layer type: "+g),this.addLayer(l,{},b))}else this.addLayer(l,{},b);var n=this,o=function(a){n.trigger(a.type,{eventType:a.type})},p=new OpenLayers.Handler.Click(this,{click:o,dblclick:o},{map:this.olMap_});p.activate(),this.zoomTo(0,0,1),this.olMap_.events.register("zoomend",this,c),this.olMap_.events.register("moveend",this,d),this.olMap_.render(this.canvas_.root())},canvasType:a.canvas.DIV_CANVAS,zoomToMaxExtent:function(){this.olMap_.zoomToMaxExtent()},zoomIn:function(){this.olMap_.zoomIn()},zoomOut:function(){this.olMap_.zoomOut()},getZoom:function(){return this.olMap_.getZoom()},zoomTo:function(a,b,c){var d=new OpenLayers.LonLat(b,a);this.olMap_.getProjection()!==t.projCode&&d.transform(t,this.olMap_.projection),this.olMap_.setCenter(d,c)},panTo:function(a,b){var c=new OpenLayers.LonLat(b,a);this.olMap_.getProjection()!==t.projCode&&c.transform(t,this.olMap_.projection),this.olMap_.panTo(c)},setExtents:function(a,b,c,d){var e=new OpenLayers.Bounds(a,d,c,b);this.olMap_.getProjection()!==t.projCode&&e.transform(t,this.olMap_.projection),this.olMap_.zoomToExtent(e)}}),w=a.vizlet.make(v);b.Map=w,a.config.register("aperture.map",function(b){b["aperture.map"]&&(b["aperture.map"].defaultMapConfig&&e.extend(u,b["aperture.map"].defaultMapConfig),a.log.info("Map configuration set."))})}return a.config.register("aperture.map",function(a){if(a["aperture.map"]&&a["aperture.map"].defaultMapConfig){var b="openlayers",d=a["aperture.map"].defaultMapConfig.mapType||b;d.toLowerCase()===b&&c()}}),b}(a.geo||{}),a.chart=function(b){var c=4,d=1,e=a.palette.color,f=function(b){this.titleLayer=this.addLayer(a.LabelLayer),this.titleLayer.map("x").from("x").only().using(this.DEFAULT_RANGE.mappedTo([0,1])),this.titleLayer.map("y").from("y").using(this.DEFAULT_RANGE.mappedTo([1,0])),this.titleLayer.map("text").from("text"),this.titleLayer.map("text-anchor").asValue("middle"),this.titleLayer.map("orientation").from("orientation"),this.titleLayer.map("offset-x").from("offset-x"),this.titleLayer.map("offset-y").from("offset-y"),this.titleLayer.map("font-family").asValue(this.valueFor("font-family",b.data,null)),this.titleLayer.map("font-size").asValue(this.valueFor("font-size",b.data,null)),this.titleLayer.map("font-weight").asValue(this.valueFor("font-weight",b.data,null))},g=function(){var a=this.valueFor("axis"),b=this.valueFor("text-anchor-y"),c=this.valueFor("text-anchor"),d=this.valueFor("layout");"x"===a?(d||this.map("layout").asValue("bottom"),b||this.map("text-anchor-y").asValue("top"),c||this.map("text-anchor").asValue("middle")):(d||this.map("layout").asValue("left"),b||this.map("text-anchor-y").asValue("middle"),c||this.map("text-anchor").asValue("end"))},h=function(a,b,c,d){var e=0,f=0,g=this.valueFor("label-offset-x",null,0),h=this.valueFor("label-offset-y",null,0);return"x"===a?("top"===b?f=-h:"bottom"===b&&(f=h),"start"===d?e=g:"end"===d&&(e=-g)):("left"===b?e=-g:"right"===b&&(e=g),"bottom"===c?f=h:"top"===c&&(f=-h)),{x:e,y:f}},i=function(b){var h,i,j=b.position[0],k=b.position[1],l=j+b.width,m=k+b.height,n=this.valueFor("axis",b.data,null);b.userData[n]=b.userData[n]||{},b.graphics.removeAll(b.userData[n].axis);var o=this.valueFor("margin",b.data,0),p=this.valueFor("rule-width",b.data,0);g.call(this);var q=this.valueFor("tick-width",b.data,d),r=this.valueFor("tick-length",b.data,c),s=this.valueFor("tick-offset",b.data,0),t=(this.valueFor("text-anchor-y",null,"bottom").toLowerCase(),null);"x"===n?(h=b.width,i=o||b.height,t=this.valueFor("layout",null,"bottom").toLowerCase(),"top"===t&&(r*=-1,s*=-1)):(h=o||b.width,i=b.height,t=this.valueFor("layout",null,"left").toLowerCase(),"right"===t&&(r*=-1,s*=-1));var u="",v=0,w=0,x=(b.data,b.data.from());if(x.get()){var y={ticks:x.get()},z=[];this.labelLayer&&("y"===n?(this.labelLayer.map("x").from("labels[].x").using(this.DEFAULT_RANGE.mappedTo([0,1])),this.labelLayer.map("y").from("labels[].y")):"x"===n&&(this.labelLayer.map("x").from("labels[].x"),this.labelLayer.map("y").from("labels[].y").using(this.DEFAULT_RANGE.mappedTo([1,0]))),this.labelLayer.map("font-family").asValue(this.valueFor("font-family",b.data,null)),this.labelLayer.map("font-size").asValue(this.valueFor("font-size",b.data,null)),this.labelLayer.map("font-weight").asValue(this.valueFor("font-weight",b.data,null)));var A,B,C,D,E,F=x.typeOf(/banded/);if(F||x.typeOf(a.Ordinal)){var G=!1;for(B=0;B<y.ticks.length;B++)if(C=y.ticks[B]){if(D=F?C.min:C,E=F?C.limit:C,D===-Number.MAX_VALUE){if(0!==B||!F||"edge"!==this.valueFor("tick-first",null,"band"))continue;D=x.start()}if(B===y.ticks.length-1&&(G=!0,E===Number.MAX_VALUE&&(F&&"edge"===this.valueFor("tick-last",null,"band")?E=x.end():G=!1)),"x"===n){if(A=this.valueFor("x",y,0,B),v=A*b.width+j,w=m+s,j>v||v>l)continue;if(u+="M"+v+","+w+"L"+v+","+(w+r),z.push({x:D,y:0,text:x.format(D)}),G){var H=this.mappings().x;if(H){var I=x.typeOf(a.Scalar);A=I?H.value(E):H.filteredValue(1),v=A*b.width+j,u+="M"+v+","+w+"L"+v+","+(w+r),I&&z.push({x:E,y:0,text:x.format(E)})}}}else"y"===n&&(A=this.valueFor("y",y,0,B),v=j-(r+s)-.5*p,w=A*i+k,u+="M"+v+","+w+"L"+(v+r)+","+w,G&&(A=this.valueFor("y",{ticks:[{min:E}]},0,0),w=A*i+k,u+="M"+v+","+w+"L"+(v+r)+","+w,z.push({x:0,y:E,text:x.format(E)})),z.push({x:0,y:D,text:x.format(D)}))}}else for(B=0;B<y.ticks.length;B++)if(C=y.ticks[B],C!==-Number.MAX_VALUE)if(A=x.map(C),"x"===n){if(v=A*b.width+j,j>v||v>l)continue;w=m+s,u+="M"+v+","+w+"L"+v+","+(w+r),z.push({x:C,y:0,text:x.format(C)})}else if("y"===n){if(v=j-(r+s)-p,w=A*b.height+k,k>w||w>m)continue;u+="M"+v+","+w+"L"+(v+r)+","+w,z.push({x:0,y:C,text:x.format(C)})}this.labelLayer.all({labels:z})}var J=this.valueFor("stroke")||e("rule"),K=[];if(p){var L;"y"===n?L="M"+j+","+k+"L"+j+","+m:"x"===n&&(w=m+s,L="M"+j+","+w+"L"+l+","+w);var M=b.graphics.path(L);b.graphics.attr(M,{fill:null,stroke:J,"stroke-width":p}),K.push(M)}var N=b.graphics.path(u);b.graphics.attr(N,{fill:null,stroke:J,"stroke-width":q}),K.push(N),b.userData[n].axis=K;var O=this.valueFor("title",b.data,null);if(O){var P;this.titleLayer||f.call(this,b),"y"===n?P={x:0,y:.5,text:O,orientation:-90,"offset-x":-o}:"x"===n&&(P={x:.5,y:0,text:O,"offset-y":o}),this.titleLayer.all(P)}},j=a.PlotLayer.extend("aperture.chart.AxisLayer",{init:function(b,c){a.PlotLayer.prototype.init.call(this,b,c),this.labelLayer=this.addLayer(a.LabelLayer),this.labelLayer.map("text").from("labels[].text"),this.labelLayer.map("label-count").from("labels.length"),this.labelLayer.map("orientation").from("orientation"),this.labelLayer.map("offset-x").from("offset-x"),this.labelLayer.map("offset-y").from("offset-y"),this.labelLayer.map("font-family").from("font-family"),this.labelLayer.map("font-size").from("font-size"),this.labelLayer.map("font-weight").from("font-weight"),this.DEFAULT_RANGE=new a.Scalar("default_range",[0,1])},canvasType:a.canvas.VECTOR_CANVAS,render:function(b){a.util.forEach(b.updates,function(a){i.call(this,a)},this),a.PlotLayer.prototype.render.call(this,b)},renderChild:function(b,e){var f,g=e.updates;for(f=0;f<g.length;f++){var i,j=g[f],k=j.position[0],l=j.position[1],m=(this.valueFor("rule-width",null,1),this.valueFor("axis",null,null));if(b===this.labelLayer){var n=this.valueFor("text-anchor-y",null,"bottom"),o=this.valueFor("text-anchor",null,null),p=this.valueFor("layout",null,null);if(b.map("text-anchor-y").asValue(n),a.util.has(e.changed,j))continue;var q,r=this.valueFor("tick-width",j.data,d),s=this.valueFor("tick-length",j.data,c),t=this.valueFor("tick-offset",j.data,0),u=(this.valueFor("margin",j.data,0),j.parent.data),v=u.from(),w=v.get();if(("x"===m&&"top"===p||"y"===m&&"right"===p)&&(s*=-1,t*=-1),v.typeOf(/banded|Ordinal/)){if("x"===m)v.typeOf(a.Scalar)?i=[k,l+(s+t)]:(q=(j.width-2*r)/w.length,i=[k+.5*q,l+(s+t)]),j.position=i;else if("y"===m){var x=this.valueFor("orientation",j.data,"vertical");"horizontal"===x?v.typeOf(a.Scalar)?i=[k-(s+t),l]:(q=(j.height-2*r)/w.length,i=[k-(s+t),l-.5*q]):i=[k-(s+t),l],j.position=i}}else"x"===m?(i=[k,l+(s+t)],j.position=i):"y"===m&&(i=[k-(s+t),l],j.position=i);var y=h.call(this,m,p,n,o);j.position[0]=j.position[0]+y.x,j.position[1]=j.position[1]+y.y}else b.uid===(this.titleLayer&&this.titleLayer.uid)&&(i=[k,l],j.position=i,this.titleLayer.map("text-anchor-y").asValue("y"===m?"top":"bottom"))}b.render(e)}});return b.AxisLayer=j,b}(a.chart||{}),a.chart=function(b){var c=function(a,b,c,d,e,f,g,h,i,j){var k=j.data,l=this.valueFor("x",k,0,g),m=this.valueFor("y",k,0,g),n=this.valueFor("stroke-width",k,1),o=this.valueFor("bar-layout",null,this.DEFAULT_BAR_LAYOUT),p=m*c,q=0,r=0,s=0,t=0;
if("horizontal"===a){r=d-e,t=p+j.position[1],t+=h-.5*i,f>0&&"stacked"!==o&&(t-=.5*n);var u=l*b,v=this.map("x").using()?b*this.map("x").using().map(0):0;u>v?(s=j.position[0]+v+e,q=Math.max(u-v,0)):(s=j.position[0]+u-e,q=Math.max(v-u,0))}else{q=d,s=l*b+j.position[0],s+=h-.5*i,f>0&&"stacked"!==o&&(s+=.5*n);var w=Math.max(p-e,0),x=this.map("y").using()?c*this.map("y").using().map(0):0;x>w?(t=j.position[1]+w-.5*(e+n),r=Math.max(x-w,0)):(t=j.position[1]+x+.5*(e+n),r=Math.max(w-x,0))}return{x:s,y:t,width:q,height:r}},d=function(a,b,c,d){var e=a.data,f=this.valueFor("stroke-width",e,1),g=this.valueFor("point-count",e,0),h=this.valueFor("spacer",null,0),i=this.valueFor("orientation",null,"vertical"),j=("horizontal"===i?c:b)/g,k=(j-(d-1)*h-2*d*f)/d,l=Math.min(this.valueFor("width",a.data,k),k);return 0>=l?1:l},e=a.BarLayer.extend("aperture.chart.BarSeriesLayer",{init:function(b,c){a.BarLayer.prototype.init.call(this,b,c),this.DEFAULT_BAR_LAYOUT="clustered"},canvasType:a.canvas.VECTOR_CANVAS,render:function(a){this.updateLayer(this.applyLayout(a.updates),a.transition)}});return e.prototype.applyLayout=function(b){var e,f=-1,g=0,h=0,i=[],j={};return a.util.forEach(b,function(a){f++,e=[],a.userData.bars||(a.userData.bars={});var k=a.data;if(0!==k.length){var l,m=this.valueFor("bar-layout",k,this.DEFAULT_BAR_LAYOUT),n="stacked"===m?1:b.length,o=this.valueFor("stroke-width",k,1),p=a.width,q=a.height,r=this.valueFor("orientation",k,"vertical"),s=this.valueFor("point-count",k,0),t=this.valueFor("border-width",k,0);if(s>0){g||(g=d.call(this,a,p,q,n)),l=n*g+(n-1)*o;var u="stacked"===m?0:f;h=u*(g+o)}else l=null;for(var v=0;s>v;v++){var w=c.call(this,r,p,q,g,t,f,v,h,l,a),x=w.x,y=w.y;if("stacked"===m){var z=0;j||(j={}),j[v]?(z=j[v],j[v]+="vertical"===r?-w.height:w.width):(j[v]=0,j[v]="vertical"===r?-w.height:w.width),"vertical"===r?y+=z:x+=z}var A={node:a,x:x,y:y,size:w,strokeWidth:o,orientation:r,visible:!0};e.push(A)}i.push(e)}},this),i},b.BarSeriesLayer=e,b}(a.chart||{}),a.chart=function(b){var c=a.palette.color,d=function(a){var b=this.valueFor("background-color",a.data,"#fff"),d=this.valueFor("border-stroke",a.data,c("border")),e=this.valueFor("border-width",a.data,1),f=this.valueFor("opacity",a.data,1),g=a.userData.plotBounds.width,h=a.userData.plotBounds.height,i=a.userData.plotBounds.position[0],j=a.userData.plotBounds.position[1],k=g-e,l=h-e,m=a.userData.plotVisual;m||(m=a.graphics.rect(i,j,k,l),a.userData.plotVisual=m),a.graphics.attr(m,{stroke:e?d:null,"stroke-width":e,opacity:f,x:i,y:j,fill:b,width:k,height:l})},e=function(a){var b=a.userData.chart,c=a.userData.chart.innerCanvas={},d=this.valueFor("title-spec",a.data,null),e=this.valueFor("y-margin",a.data,0),f=this.valueFor("x-margin",a.data,0);!e&&this.axisArray.y[0]&&(e=this.axisArray.y[0].valueFor("margin",a.data,0)),!f&&this.axisArray.x[0]&&(f=this.axisArray.x[0].valueFor("margin",a.data,0));var g=this.axisArray.y[0]&&this.axisArray.y[0].valueFor("visible",null,!1),h=d&&this.valueFor("title-margin",a.data,this.MIN_TITLE_MARGIN)||g&&e&&this.MIN_TITLE_MARGIN||0;if(0===e&&0===f)return a.userData.plotBounds={width:b.width,height:b.height-h,position:[b.position[0],b.position[1]+h]},c.width=b.width,c.height=b.height-h,void(c.position=[b.position[0],b.position[1]+h]);var i=b.width-e,j=b.height-f-h,k=e+b.position[0],l=h+b.position[1];a.userData.plotBounds={width:i,height:j,position:[k,l]},c.width=i,c.height=j,c.position=[k,l]},f=function(b){var c=this.valueFor("title-spec",b.data,null);c&&(this.titleLayer||(this.titleLayer=this.addLayer(a.LabelLayer),this.titleLayer.map("text-anchor").asValue("middle"),this.titleLayer.map("x").from("x").only().using(this.DEFAULT_RANGE.mappedTo([0,1])),this.titleLayer.map("y").from("y").only().using(this.DEFAULT_RANGE.mappedTo([1,0])),this.titleLayer.map("text").from("text"),this.titleLayer.map("text-anchor-y").asValue("top"),this.titleLayer.map("orientation").asValue(null),this.titleLayer.map("font-family").asValue(c["font-family"]||null),this.titleLayer.map("font-size").asValue(c["font-size"]||null),this.titleLayer.map("font-weight").asValue(c["font-weight"]||null)),this.titleLayer.all({x:.5,y:1,text:c.text}))},g=function(){a.util.forEach(this.axisArray.x,function(a){if(a.valueFor("visible")===!0){var b=this.mappings().x.transformation,c=b.from();a!==this.axisArray.x[0]&&a.hasLocalData||a.all(b),a.map("x").from(c.typeOf(/banded/)?"ticks[].min":"ticks[]");var d=this.valueFor("x-margin",null,0),e=this.axisArray.x[0].valueFor("margin",null,0);e!==d&&this.map("x-margin").asValue(e)}},this),a.util.forEach(this.axisArray.y,function(a){if(a.valueFor("visible")===!0){var b=this.mappings().y.transformation,c=b.from();a!==this.axisArray.y[0]&&a.hasLocalData||a.all(b),a.map("y").from(c.typeOf(/banded/)?"ticks[].min":"ticks[]");var d=this.valueFor("y-margin",null,0),e=this.axisArray.y[0].valueFor("margin",null,0);e!==d&&this.map("y-margin").asValue(e)}},this)},h=function(a){return a===this.titleLayer||a.typeOf(b.AxisLayer)?!0:!1},i=function(a){return null==a?this.center:(a=Math.max(.5/this.zoomValue,Math.min(1-.5/this.zoomValue,a)),this.center!==a?(this.center=a,!0):void 0)},j=a.PlotLayer.extend("aperture.chart.ChartLayer",{init:function(b,d){a.PlotLayer.prototype.init.call(this,b,d),this.specData=b.data,this.DEFAULT_XMARGIN=40,this.DEFAULT_YMARGIN=50,this.DEFAULT_RANGE=new a.Scalar("default_range",[0,1]),this.DEFAULT_BANDS=5,this.MIN_TITLE_MARGIN=10,this.map("border-width").asValue(1),this.map("border-stroke").asValue(c("border")),this.map("orientation").asValue("vertical"),this.axisArray={x:[],y:[]}},canvasType:a.canvas.VECTOR_CANVAS,render:function(b){var c=b.updates;if(c.length>0){var h,i;for(h=0;h<c.length;h++)i=c[h],i.userData.chart={},this.width=i.userData.chart.width=this.valueFor("width",i.data,i.width),this.height=i.userData.chart.height=this.valueFor("height",i.data,i.height),i.userData.chart.position=i.position,e.call(this,i),d.call(this,i),f.call(this,i);g.apply(this)}a.PlotLayer.prototype.render.call(this,b)},renderChild:function(b,c){a.util.forEach(c.updates,function(c){{var d=c.parent.userData.chart.innerCanvas;this.valueFor("border-width",c.data,1)}if(c.width=d.width,c.height=d.height,c.position=[d.position[0],d.position[1]],b===this.titleLayer)c.position=[d.position[0],c.parent.position[1]];else if(!h.call(this,b)){c.position=[c.position[0],c.position[1]];var e=this.valueFor("orientation",c.data,"vertical");if("horizontal"===e){var f=this.mappings().y.transformation,g=f.from();if(g.typeOf(a.Ordinal)){var i=c.height/g.get().length;c.position=[c.position[0],c.position[1]-.5*i]}}else{var j=this.mappings().x.transformation,k=j.from();if(k.typeOf(a.Ordinal)){var l=c.width/k.get().length;c.position=[c.position[0]+.5*l,c.position[1]]}}c.graphics.clip(this.valueFor("clipped",c.data,!0)?[d.position[0],d.position[1],d.width,d.height]:null)}},this),b.render(c)},ruleLayer:function(b){var c=this.ruleLayers||[];if(void 0===b)return c;null===b&&(b=0);var d=c[b];if(!d){d=c[b]=this.addLayer(a.chart.RuleLayer);var e=this;d.map("rule").filter(function(a){return"x"===d.valueFor("axis",this,null)?e.panfilter(a):a}),this.ruleLayers=c,d.toBack()}return d},xAxis:function(b){if(-1===b)return this.axisArray.x;(!b||b>1)&&(b=0);var c=this.axisArray.x[b];return c||(c=this.addLayer(a.chart.AxisLayer),c.map("visible").asValue(!0),c.map("axis").asValue("x"),this.axisArray.x[b]=c),c},yAxis:function(b){if(-1===b)return this.axisArray.y;(!b||b>1)&&(b=0);var c=this.axisArray.y[b];if(!c){c=this.addLayer(a.chart.AxisLayer),c.map("visible").asValue(!0),c.map("axis").asValue("y"),this.axisArray.y[b]=c;var d=this.mappings().x;if(d){var e=d.transformation;this.axisArray.y[b].map("x").only().using(e)}}return c}});return b.ChartLayer=j,b.Chart=a.vizlet.make(j,function(){this.zoomValue=1,this.center=.5,this.panning=!1,this.startCenter={},this.on("drag",function(a){switch(a.eventType){case"dragstart":this.startCenter=this.center,this.panning=!1;break;case"drag":this.panning=this.panning||Math.abs(a.dx)>3,this.panning&&this.zoomTo(this.startCenter-a.dx/this.width/this.zoomValue)}return!0});var b=this;this.panfilter=function(a){return(a-b.center)*b.zoomValue+.5},this.map("x").filter(this.panfilter),this.updateAxes=function(){var b,c=this.width/100;if(this.axisArray.x[0]){var d=this.mappings().x.transformation,e=d.from();b=e.banded(c*this.zoomValue),d=b.mappedTo([0,1]),this.map("x").using(d),this.xAxis(0).all(d),a.util.forEach(this.ruleLayer(),function(a){"x"===a.valueFor("axis")&&(a.all(b.get()),a.map("rule").using(d))})}else b=null;if(this.axisArray.x[1]){var f=b.formatter().nextOrder();if(f){var g=b.banded({span:1,units:f});this.xAxis(1).all(g.mappedTo([0,1]))}this.xAxis(1).map("visible").asValue(!!f)}},this.zoomTo=function(a,b,c){var d;c=Math.max(c||this.zoomValue,1),this.zoomValue!==c&&(this.zoomValue=c,d=!0,this.updateAxes()),(i.call(this,a)||d)&&(this.trigger("zoom",{eventType:"zoom",layer:this}),this.updateAxes(a),this.all().redraw())},this.zoom=function(a){return null==a?{zoom:this.zoomValue,x:this.center,y:.5}:void this.zoomTo(this.center,null,a)}}),b}(a.chart||{}),a.chart=function(b){function c(a){switch(a){case"dashed":return"- ";case"dotted":return". ";case"none":return null;case"":case"solid":return""}return a}var d=function(a){var b=[],d=0,e=c(this.valueFor("stroke-style",a,"solid",0)),f=this.valueFor("stroke",a,"#000000",0),g=this.valueFor("point-count",a,1,0);if(2>g)return b;var h,i=[{x:this.valueFor("x",a,0,0),y:this.valueFor("y",a,0,0)}];for(h=1;g>h;h++){var j=c(this.valueFor("stroke-style",a,"solid",h)),k=this.valueFor("stroke",a,"#000000",h),l=j!==e||k!==f,m=g-1>h,n=this.valueFor("x",a,0,h),o=this.valueFor("y",a,0,h);i.push({x:n,y:o}),(l||!m)&&(b.push({points:i,"stroke-style":e,stroke:f}),i=[{x:n,y:o}],d=h-1,e=j,f=k)}return b},e=function(a){var b,c,d,e,f,g=a.node.position;for(f=0;f<a.points.length;f++)c=a.points[f],d=c.x*a.node.width+(g[0]||0),e=c.y*a.node.height+(g[1]||0),0===f&&(b="M"+d+","+e),b+="L"+d+","+e;return b},f=a.Layer.extend("aperture.chart.LineSeriesLayer",{init:function(b,c){a.Layer.prototype.init.call(this,b,c)},canvasType:a.canvas.VECTOR_CANVAS,render:function(a){var b,c=a.updates;for(b=c.length-1;b>=0;b--){var f=c[b];if(0!==f.data.length){f.userData.pathSegments||(f.userData.pathSegments=[]);var g,h,i=this.valueFor("stroke-width",f.data,1),j=this.valueFor("opacity",f.data,1),k=this.valueFor("lines",f.data,null),l=[];if(k)for(g=0;g<k.length;g++){var m=d.call(this,k[g]);for(h=0;h<m.length;h++)l.push(m[h])}else l=d.call(this,f.data);var n,o,p,q,r,s,t,u=f.userData.pathSegments.length,v=l.length;for(u>v&&f.graphics.removeAll(f.userData.pathSegments.splice(v,u-v)),s=0;v>s;s++){p=l[s],r=p.points,o={points:r,node:f},n=e.call(this,o),t=f.userData.pathSegments[s],q=p["stroke-style"],null===q&&(q="",j=0);var w={stroke:p.stroke,"stroke-width":i,"stroke-linejoin":"round","stroke-dasharray":q,"stroke-opacity":j},x=!0;if(t){var y=f.graphics.attr(t,"path").toString();n===y?(f.graphics.attr(t,"stroke")!==p.stroke&&(w.stroke=p.stroke),f.graphics.attr(t,"stroke-width")!==i&&(w["stroke-width"]=i),f.graphics.attr(t,"stroke-dasharray")!==q&&(w["stroke-dasharray"]=q),f.graphics.attr(t,"stroke-opacity")!==j&&(w["stroke-opacity"]=j),x=!1):w.path=n}else t=f.graphics.path(n);f.graphics.attr(t,w,a.transition),x&&(f.graphics.data(t,f.data),f.userData.pathSegments[s]=t)}}}}});return b.LineSeriesLayer=f,b}(a.chart||{}),a.chart=function(b){var c=a.palette.color,d=function(b){if(b){var d=this.valueFor("border-width",b.data,0),e=this.valueFor("opacity",b.data,1),f=this.valueFor("axis",b.data,"x"),g=this.valueFor("rule",b.data,0),h=this.valueFor("stroke",b.data,c("rule")),i=this.valueFor("stroke-width",b.data,1),j=this.valueFor("stroke-style",b.data,"");switch(j){case"dashed":j="- ";break;case"dotted":j=". ";break;case"none":e=0;case"":case"solid":j=""}var k="",l=0,m=0,n=0,o=0,p=this.mappings().x.transformation.from(),q=this.mappings().y.transformation.from();p.typeOf(a.Ordinal)&&(n=.5*(b.width/p.get().length)),q.typeOf(a.Ordinal)&&(o=.5*(b.height/q.get().length)),"x"===f?(l=g*b.width+b.position[0]+n,m=b.position[1]+o,k+="M"+l+","+m+"L"+l+","+(m+b.height-d)):(l=b.position[0]-n,m=g*b.height+b.position[1]+o,k+="M"+l+","+m+"L"+(l+b.width-d)+","+m);var r=b.graphics.path(k);b.graphics.attr(r,{fill:null,stroke:h,"stroke-width":i,"stroke-dasharray":j,opacity:e}),b.userData.rulelines.push(r)}},e=a.Layer.extend("aperture.chart.RuleLayer",{init:function(b,c){a.Layer.prototype.init.call(this,b,c)},canvasType:a.canvas.VECTOR_CANVAS,render:function(b){a.util.forEach(b.updates,function(a){a.graphics.removeAll(a.userData.rulelines),a.userData.rulelines=[],d.call(this,a)},this)}});return b.RuleLayer=e,b}(a.chart||{}),a.canvas=function(b){function c(a){var b=this[a];b&&b.parentNode&&b.parentNode.removeChild(b),this.hasOwnProperty(a)&&delete this[a]}function d(a){var b,c=0;if("set"===a.type)for(b=a.length;b>c;++c)d.call(this,a[c]);else this.kids.push(a),this.node.appendChild(a.node);return this}function e(){c.call(this,"node"),c.call(this,"clipNode");var a,b=0,d=this.kids;for(a=d.length;a>b;++b)d[b].remove();this.kids.length=0}function f(a){return this.node.style.display=a?"":"none",this}if(!window.Raphael)return void a.log.error("raphael.js must be included before aperture.");var g=a.util,h=a.Class.extend("[private].MouseOutTracker",{mouseMoveCallback:function(a){if(this.trackEvent){for(var b=a.target;null!=b;){if(b===this.trackTarget)return;b=b.parentNode}this.trigger(a),this.untrack()}},track:function(a,b){var c=!1,d=a.source;this.trackEvent&&(c=!0,this.trackEvent.source.target!==d.target&&this.trigger(d)),this.trackEvent=a,this.trackTarget=d.currentTarget,this.client=b,c||Raphael.el.mousemove.call(this,this.mouseMoveCallback,this)},untrack:function(){this.trackEvent&&(this.trackEvent=null,this.trackTarget=null,this.client=null,Raphael.el.unmousemove.call(this,this.mouseMoveCallback))},trigger:function(a){var b=g.viewOf(this.trackEvent);b.source=g.viewOf(b.source),b.source.clientX=a.clientX,b.source.clientY=a.clientY,b.source.screenX=a.screenX,b.source.screenY=a.screenY,null!=a.pageX&&(b.source.pageX=a.pageX,b.source.pageY=a.pageY),null!=a.offsetX&&(b.source.offsetX=a.offsetX,b.source.offsetY=a.offsetY),this.client.trigger(b.eventType="mouseout",b)}}),i=b.RaphaelGraphics=b.VectorGraphics.extend("aperture.canvas.RaphaelGraphics",{init:function(a){this.canvas=a,this.paper=a.paper,this.animation=a.animation,this.container=a.paper.container(),this.showing=!0,this.events={},a.container&&(a.container.push(this.container),this.canvas=a.canvas,this.parent=a)},path:function(a){var b=this.paper.path(a);return this.container.push(b),b},circle:function(a,b,c){var d=this.paper.circle(a,b,c);return this.container.push(d),d},rect:function(a,b,c,d){var e=this.paper.rect(a,b,c,d);return this.container.push(e),e},text:function(a,b,c){var d=this.paper.text(a,b,c);return d.attr("cursor","default"),this.container.push(d),d},image:function(a,b,c,d,e){var f=this.paper.image(a,b,c,d,e);return this.container.push(f),f},clip:function(a){this.container.clip(a)},origin:function(a,b){this.container.origin(a,b)},display:function(a){return this.showing!==a?(this.container.show(this.showing=a),!0):void 0},toFront:function(a){if(a)a.toFront();else{var b=this.container.node;b.parentNode.appendChild(b)}return this},toBack:function(a){if(a)a.toBack();else{var b=this.container.node,c=b.parentNode;c.firstChild.isEqualNode(b)||c.insertBefore(b,c.firstChild)}return this},remove:function(a){if(0===arguments.length)return null!=this.mouseOutTracker&&this.mouseOutTracker.untrack(),this.container.remove(),this;if(a){var b=this.container.kids,c=g.indexOf(b,a);return c>=0&&b.splice(c,1),a.remove(),a}},removeAll:function(a){var b,c,d=this.container.kids;if(null!=a)for(b=a.length;b-->0;)(c=g.indexOf(d,a[b]))>=0&&d.splice(c,1),a[b].remove();else{for(b=0,c=d.length;c>b;++b)d[b].remove();this.container.kids.length=0}},data:function(a,b,c){var d=arguments.length;switch(d){case 0:return this.dataObj;case 1:return a.raphael?a.data("data"):(this.dataObj=a,this);default:return a.data("data",{data:b,index:c}),this}},dataFromEvent:function(a){var b=a.target=a.srcElement||a.target||document,c=this.container.node;if(b){for(var d;!(b.raphael&&(d=this.paper.getById(b.raphaelid).data("data"))||b===c);)if(b=b.parentNode,null===b)return;return d||this.dataObj}},on:function(b,c){if(!this.events[b]&&Raphael.el[b]){var d=this;if("drag"!==b)Raphael.el[b].call(this.container,this.events[b]=function(e){var f=d.dataFromEvent(e);if(f){var g={data:f.data,node:new a.Layer.SingleNodeSet(d.dataObj),index:f.index?f.index.slice():void 0,eventType:b,source:e};switch(b){case"mouseover":case"mousemove":null==this.mouseOutTracker&&(this.mouseOutTracker=new h),this.mouseOutTracker.track(g,c);break;case"mouseout":null!=this.mouseOutTracker&&this.mouseOutTracker.untrack()}c.trigger(b,g)}});else{var e;Raphael.el.drag.call(this.container,function(b,f,g,h,i){e&&c.trigger("drag",{data:e.data,node:new a.Layer.SingleNodeSet(d.dataObj),index:e.index?e.index.slice():void 0,eventType:"drag",source:i,dx:b,dy:f,x:g,y:h})},function(b,f,g){e=d.dataFromEvent(g),e&&c.trigger("drag",{data:e.data,node:new a.Layer.SingleNodeSet(d.dataObj),index:e.index?e.index.slice():void 0,eventType:"dragstart",source:g,x:b,y:f})},function(b){e&&c.trigger("drag",{data:e.data,node:new a.Layer.SingleNodeSet(d.dataObj),index:e.index?e.index.slice():void 0,eventType:"dragend",source:b})})}}},off:function(a){if("drag"===a)Raphael.el.undrag.call(this.container);else{var b=Raphael.el["un"+a],c=this.events[a];b&&c&&b.call(this.container,c)}},apparate:function(a,b){if(b){var c=a.attr("opacity");a.attr("opacity",0),this.attr(a,{opacity:c},b)}},attr:function(a,b,c){if(g.isString(b))return a.attr(b);if(c){var d,e,f,h,i,j={},k={};for(f in b)if(b.hasOwnProperty(f)&&(i=a.attr(f),h=b[f],null==i||i.toFixed||(i=i.toString()),null==h||h.toFixed||(h=h.toString()),i!==h)){if(i&&i.charCodeAt)switch(f){case"clip-rect":case"fill":case"stroke":case"path":case"transform":break;default:i=null}i?(d=!0,j[f]=h):(e=!0,k[f]=h)}if(e&&a.attr(k),d){var l=this.animation.anim;l||(l=this.animation.anim={element:this.paper.rect(-9999,-9999,1,1)},l.animation=Raphael.animation({width:2},c.milliseconds(),c.easing(),function(){l.element.remove(),c.callback()&&c.callback()()}),l.element.animate(l.animation)),a.animateWith(l.element,l.animation,j,c.milliseconds(),c.easing())}}else a.attr(b)}});b.RaphaelCanvas=b.VectorCanvas.extend("aperture.canvas.RaphaelCanvas",{init:function(a){b.VectorCanvas.prototype.init.call(this,a),this.paper=Raphael(a,"100%","100%"),this.animation={}},remove:function(){return this.paper.remove()},graphics:function(a){return new i(a&&a.typeOf(b.RaphaelGraphics)?a:this)},flush:function(){this.animation.anim=null,b.VectorCanvas.prototype.flush.call(this)}}),b.handle(b.VECTOR_CANVAS,b.RaphaelCanvas),Raphael.easing_formulas.ease=Raphael.easing_formulas["ease-in-out"];var j,k,l,m=Raphael;return m.vml?(l=function(){var a=document.createElement("div");return a.style.position="absolute",a.style.left=a.style.top="0",a},j=function(a,b){var c=this.node.style;return c.left=a+"px",c.top=b+"px",this},k=function(a){var b=this.node.style;return a&&4===a.length?b.clip="rect("+a[1]+"px "+(a[0]+a[2])+"px "+(a[1]+a[3])+"px "+a[0]+"px)":b.clip&&(b.clip=""),this}):(l=function(a){return a=document.createElementNS("http://www.w3.org/2000/svg",a)},j=function(a,b){return this.node.setAttribute("transform","translate("+a+", "+b+")"),this},k=function(a){c.call(this,"clipNode");var b="";if(a&&4===a.length){var d=this.clipNode=l("clipPath"),e=l("rect");e.setAttribute("x",String(a[0])),e.setAttribute("y",String(a[1])),e.setAttribute("width",String(a[2])),e.setAttribute("height",String(a[3])),d.id=m.createUUID(),d.appendChild(e),this.paper.defs.appendChild(d),b="url(#"+d.id+")"}return this.node.setAttribute("clip-path",b),this}),m.fn.container=function(){var a=l("g");a.style.pointerEvents="auto";var b=m.createUUID();return this.canvas.appendChild(a),{id:b,node:a,paper:this,type:"container",push:d,kids:[],show:f,remove:e,origin:j,clip:k,mousedown:m.el.mousedown}},b}(a.canvas||{}),a}(aperture||{});